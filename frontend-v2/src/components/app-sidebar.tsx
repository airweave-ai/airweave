import { Link, useLocation, useParams } from "@tanstack/react-router";
import { Plus } from "lucide-react";

import { Button } from "@/components/ui/button";
import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupContent,
  SidebarHeader,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarRail,
} from "@/components/ui/sidebar";
import { UserAccountDropdown } from "@/components/user-account-dropdown";
import { navItems } from "@/config/navigation";
import { useCreateCollectionStore } from "@/stores/create-collection-store";

export function AppSidebar() {
  const location = useLocation();
  const params = useParams({ strict: false }) as { orgSlug?: string };
  const orgSlug = params.orgSlug;
  const openCreateCollection = useCreateCollectionStore((s) => s.open);

  if (!orgSlug) {
    return null;
  }

  const isActive = (to: string) => {
    const fullPath = to.replace("$orgSlug", orgSlug);
    return location.pathname.startsWith(fullPath);
  };

  return (
    <Sidebar collapsible="icon" side="left" className="py-2">
      <SidebarHeader>
        <SidebarMenu>
          <SidebarMenuItem>
            <Button
              className="mb-1 flex h-auto w-full justify-start gap-2 py-2 text-slate-100 group-data-[collapsible=icon]:pl-2 hover:bg-slate-100/10 hover:text-slate-100 dark:text-slate-100 dark:hover:text-slate-100"
              size="sm"
              variant="ghost"
              asChild
            >
              <Link to="/$orgSlug/collections" params={{ orgSlug }}>
                <svg
                  className="shrink-0"
                  viewBox="0 0 143 143"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M89.3854 128.578C79.4165 123.044 66.2502 114.852 60.0707 107.348L59.5432 106.724C58.2836 105.206 56.981 103.72 55.6676 102.299C51.4152 97.6699 46.8614 93.5036 42.146 89.9079C40.2405 88.4546 38.2704 87.055 36.3111 85.7847C35.2991 85.128 34.3302 84.5251 33.4151 83.9761C31.1221 82.6088 28.3338 82.2321 25.7716 82.9534C23.3385 83.6424 21.39 85.2464 20.2596 87.4534C18.0634 91.7381 19.5814 97.0347 23.7046 99.5108C27.0204 101.492 30.2608 103.817 33.3398 106.422C33.7381 106.756 33.8996 107.284 33.7596 107.768C32.6292 111.891 31.4989 118.663 31.0682 121.376C30.1424 127.135 32.9737 132.787 38.0982 135.457L38.2812 135.554C40.5204 136.706 43.1472 136.652 45.3219 135.403C47.4858 134.165 48.853 131.937 48.9822 129.439C49.036 128.363 49.1006 127.286 49.176 126.296C49.219 125.768 49.542 125.337 50.0264 125.165C50.1772 125.111 50.3494 125.079 50.5001 125.079C50.8554 125.079 51.1784 125.219 51.4475 125.488C55.743 129.891 60.3829 133.875 65.2167 137.33C69.8674 140.657 75.3686 142.412 81.139 142.412C83.2383 142.412 85.3376 142.175 87.3938 141.701L87.6199 141.647C90.4943 140.98 92.529 138.73 92.9488 135.791C93.3687 132.852 91.9476 130.02 89.3747 128.589H89.3639L89.3854 128.578Z"
                    fill="currentColor"
                  />
                  <path
                    d="M142.051 57.8805L142.029 57.7621C141.545 55.2968 139.618 53.4128 137.098 52.9606C134.612 52.5192 132.254 53.5635 130.984 55.6951L130.908 55.8135C126.204 63.8662 119.561 71.3159 111.153 78.0014C108.946 79.7562 106.793 81.6078 104.726 83.5134C103.144 84.9775 100.765 85.2359 98.9452 84.127C97.1474 83.0397 95.3495 81.8447 93.6055 80.5744C89.8268 77.8291 86.1772 74.6533 82.7753 71.1329C80.9989 69.3028 79.298 67.3973 77.6939 65.438C75.5408 62.8219 73.2477 60.2597 70.8685 57.8374C65.8195 52.6915 56.1089 45.6185 53.2453 43.5838C52.8792 43.3362 52.6639 42.9486 52.5993 42.5073C52.5455 42.0659 52.6639 41.6567 52.9546 41.3122C54.774 39.1376 56.4965 36.8876 58.0683 34.6268C59.7369 32.2369 60.286 29.3086 59.5862 26.5957C58.908 23.9581 57.1424 21.8158 54.634 20.5885C50.4139 18.5 45.3972 19.8026 42.7273 23.6351C40.3373 27.0694 37.5167 30.439 34.3732 33.6364C34.0718 33.9378 33.6304 34.0455 33.2213 33.8948C30.0239 32.8505 26.7296 32 23.4461 31.3648C23.2093 31.3218 22.854 31.2572 22.4126 31.2034C15.9102 30.2345 9.61233 33.4857 6.71639 39.2775L6.6195 39.4606C5.68289 41.3338 5.76902 43.5407 6.82405 45.3709C7.90061 47.2226 9.82765 48.4068 11.9592 48.5252C12.9604 48.579 13.9401 48.6436 14.8659 48.7082C15.2966 48.7405 15.6411 48.9881 15.8025 49.3972C15.9533 49.8171 15.8671 50.2477 15.5657 50.5599C11.647 54.5862 8.10515 58.9032 5.0262 63.3925C0.644601 69.7872 -0.981008 77.9153 0.580002 85.688L0.601538 85.8064C1.20441 88.7777 3.55131 90.9093 6.57644 91.2323C9.48315 91.5445 12.1099 90.0266 13.2619 87.3782L13.3265 87.2167C18.1925 75.5683 26.2559 65.2226 37.2907 56.4594C37.8182 56.0503 38.5072 55.9858 39.067 56.298C44.8373 59.4738 50.3601 63.6078 55.4738 68.5923C56.0982 69.1951 56.1089 70.2071 55.5168 70.8315C52.9761 73.5122 50.5862 76.3112 48.4115 79.1749C46.7106 81.4141 47.0335 84.6007 49.1221 86.4416L52.8254 89.7036L52.7824 89.7467C53.3637 90.2634 53.945 90.7802 54.5264 91.2969L55.3123 91.8998C56.4319 92.8902 57.8529 93.3423 59.3386 93.1916C60.8027 93.0409 62.17 92.2658 63.0635 91.0816C64.6353 88.9931 66.3578 86.9584 68.1556 85.0098C68.457 84.676 68.8661 84.5038 69.3075 84.4931C69.7705 84.4931 70.1257 84.6437 70.4164 84.9344C75.3147 89.7682 80.6114 94.0744 86.1772 97.7024C88.3626 99.1234 88.9978 101.966 87.6306 104.183C86.4248 106.153 85.2729 108.199 84.2179 110.244C83.0014 112.624 82.7968 115.444 83.6688 117.963C84.4978 120.385 86.2095 122.291 88.481 123.346C89.7514 123.938 91.0971 124.24 92.4859 124.24C96.0062 124.24 99.182 122.302 100.786 119.158C102.229 116.316 103.919 113.506 105.781 110.836C106.869 109.265 108.86 108.543 110.755 109.028C114.76 110.061 120.143 111.127 123.954 111.848C127.808 112.57 131.619 110.729 133.46 107.284L133.643 106.939C135.021 104.334 135.031 101.212 133.664 98.5959C132.286 95.9584 129.681 94.1713 126.71 93.8268C125.978 93.7407 125.278 93.6546 124.61 93.5684C124.47 93.5469 124.352 93.5254 124.244 93.5038L122.856 93.1809L123.857 92.1581C123.932 92.0828 124.029 91.9859 124.158 91.8998C128.271 88.5086 132.071 84.9021 135.462 81.1772C141.168 74.9009 143.622 66.2023 142.018 57.8805H142.029H142.051Z"
                    fill="currentColor"
                  />
                  <path
                    d="M56.1506 14.0429C65.0861 19.3396 76.9067 27.0801 82.4833 33.8732C83.14 34.659 83.7967 35.4449 84.4534 36.1985C85.6591 37.5873 85.7991 39.5789 84.7979 41.1292C82.9892 43.9174 80.9115 46.6627 78.6399 49.3003C76.9713 51.2165 76.9067 54.0156 78.4785 55.9534L78.5431 56.0288C78.7261 56.2656 78.9306 56.5132 79.1136 56.75C80.7931 58.8816 82.5801 60.9271 84.4211 62.8433C85.4007 63.8661 86.7249 64.4367 88.1352 64.4367L88.2644 65.2333L88.2429 64.4367C89.707 64.4044 91.1173 63.7584 92.0969 62.6388C94.3362 60.1089 96.4247 57.4498 98.3302 54.7691C99.6329 52.9282 102.13 52.5084 104.025 53.8111C105.963 55.146 107.965 56.4163 109.957 57.5897C112.293 58.957 115.114 59.2153 117.665 58.268C120.249 57.3098 122.262 55.2752 123.156 52.6591C124.555 48.6113 122.757 43.9605 118.882 41.6136C116.255 40.0203 113.65 38.2224 111.174 36.2846C109.882 35.2619 109.333 33.5825 109.796 32C110.937 28.0059 111.981 22.8276 112.648 19.1889C113.337 15.4317 111.647 11.5884 108.439 9.65058L108.062 9.43525C105.371 7.83118 102.087 7.71277 99.2668 9.1123C96.4247 10.5226 94.53 13.2463 94.1855 16.3791L94.1639 16.5728C94.1209 16.9604 93.884 17.2511 93.518 17.3695C93.152 17.4879 92.7859 17.3911 92.5168 17.1327C88.5012 12.848 84.238 8.96157 79.8134 5.57041C73.8708 1.01656 66.2811 -0.878188 58.9928 0.381386L58.6805 0.435234C55.6124 0.973513 53.2547 3.30965 52.6949 6.3886C52.1351 9.43527 53.4915 12.4281 56.1722 14.0106H56.1614L56.1506 14.0429Z"
                    fill="currentColor"
                  />
                </svg>
                <div className="flex grow items-center justify-stretch group-data-[collapsible=icon]:hidden">
                  <svg
                    viewBox="0 0 356 66"
                    className="size-18 h-auto"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M350.783 25.4493C347.015 20.6063 341.21 18.0454 333.992 18.0454C327.205 18.0454 321.499 20.3343 317.485 24.6665C313.531 28.9324 311.442 34.9364 311.442 42.0219C311.442 49.1073 313.558 55.191 317.572 59.4569C321.599 63.736 327.311 66.005 334.078 66.005C344.64 66.005 352.468 60.3724 354.518 51.3099L354.618 50.8522H344.514L344.427 51.1109C343.538 54.0499 340.281 57.4798 334.084 57.4798C330.482 57.4798 327.55 56.3388 325.4 54.0964C323.37 51.9667 322.11 48.842 321.765 45.0471H354.923L354.969 44.7353C355.978 36.9334 354.538 30.2659 350.79 25.456L350.783 25.4493ZM333.647 26.3914C337.163 26.3914 340.082 27.5193 342.092 29.6555C343.923 31.6193 344.912 34.2929 344.945 37.4044H322.043C322.508 34.0474 323.801 31.2809 325.765 29.3702C327.782 27.4197 330.509 26.3848 333.647 26.3848V26.3914Z"
                      fill="currentColor"
                    />
                    <path
                      d="M311.315 19.3657L311.143 19.8699L295.406 64.6715H282.681L282.595 64.426L266.772 19.3657H277.639L277.726 19.6178L289.044 53.4064L300.455 19.3657H311.315Z"
                      fill="currentColor"
                    />
                    <path
                      d="M265.2 55.7947V36.3628C265.2 30.2327 263.475 25.5621 260.065 22.4705C256.828 19.5315 252.097 18.0387 245.987 18.0387C240.189 18.0387 235.545 19.3988 232.201 22.079C228.844 24.7593 226.84 28.72 226.263 33.8483L226.21 34.2597H236.155L236.202 33.9346C236.493 31.5794 237.449 29.755 239.048 28.5077C240.686 27.214 243.002 26.5639 245.908 26.5639C248.634 26.5639 250.877 27.1477 252.396 28.2556C254.068 29.4697 254.917 31.3074 254.917 33.7024C254.917 34.943 254.665 35.7856 254.181 36.3163C253.776 36.7277 253.205 36.9798 252.356 37.0992L241.111 37.9351C235.989 38.2801 231.982 39.7065 229.229 42.1346C226.502 44.5363 225.129 47.8004 225.129 51.8274C225.129 55.8544 226.595 59.4768 229.375 62.0177C232.228 64.6117 236.268 65.9917 241.051 65.9917C248.117 65.9917 253.557 63.0261 256.443 57.6324C256.702 59.7023 257.411 61.3476 258.539 62.5153C259.919 63.935 261.916 64.6648 264.49 64.6648H268.842V55.7881H265.22L265.2 55.7947ZM242.716 57.5661C240.381 57.5661 238.57 57.0353 237.323 55.9937C236.042 54.9322 235.392 53.3533 235.392 51.3032C235.392 49.4257 235.943 48.0259 237.084 47.0042C238.311 45.9096 240.275 45.2461 242.922 45.0404L243.061 45.0272L255.076 44.178V45.4717C255.076 48.9879 253.862 52.0065 251.58 54.2224C249.344 56.3852 246.199 57.5661 242.71 57.5661H242.716Z"
                      fill="currentColor"
                    />
                    <path
                      d="M216.79 25.4493C213.022 20.6063 207.216 18.0454 199.998 18.0454C193.211 18.0454 187.506 20.3343 183.499 24.6665C179.538 28.9324 177.442 34.9364 177.442 42.0219C177.442 49.1073 179.558 55.191 183.572 59.4569C187.599 63.736 193.311 66.005 200.078 66.005C210.64 66.005 218.468 60.3724 220.518 51.3099L220.618 50.8522H210.514L210.441 51.1109C209.538 54.0499 206.294 57.4798 200.085 57.4798C196.482 57.4798 193.55 56.3388 191.4 54.0964C189.37 51.9667 188.11 48.842 187.765 45.0471H220.923L220.969 44.7353C221.991 36.9334 220.545 30.2659 216.79 25.456V25.4493ZM188.043 37.411C188.508 34.054 189.801 31.2875 191.765 29.3768C193.782 27.4264 196.509 26.3914 199.647 26.3914C203.163 26.3914 206.082 27.5193 208.092 29.6555C209.93 31.6193 210.912 34.2929 210.945 37.4044H188.043V37.411Z"
                      fill="currentColor"
                    />
                    <path
                      d="M176.5 19.3657L176.347 19.8433L162.833 64.6715H152.019L151.946 64.4061L143.806 34.6378L135.513 64.6715H124.785L124.713 64.4127L111.119 19.3657H121.813L121.886 19.6376L130.192 50.9517L138.93 19.3657H148.689L148.762 19.6376L157.34 50.9517L165.806 19.3657H176.5Z"
                      fill="currentColor"
                    />
                    <path
                      d="M107.291 19.3657V28.2424H92.6157V64.6715H82.4121V29.6356C82.4121 26.3383 83.3144 23.7775 85.0791 22.0061C86.8372 20.2613 89.3981 19.3657 92.6755 19.3657H107.284H107.291Z"
                      fill="currentColor"
                    />
                    <path
                      d="M76.6923 6.03726C76.6923 9.48047 74.0452 11.975 70.3963 11.975C66.7474 11.975 64.1003 9.48047 64.1003 6.03726C64.1003 2.59404 66.8668 1.57356e-05 70.3963 1.57356e-05C73.9258 1.57356e-05 76.6923 2.64712 76.6923 6.03726Z"
                      fill="currentColor"
                    />
                    <path
                      d="M75.4521 19.3657H65.2485V64.6715H75.4521V19.3657Z"
                      fill="currentColor"
                    />
                    <path
                      d="M38.4857 7.50345C37.1854 4.17965 34.0341 2.04339 30.4648 2.04339C26.8956 2.04339 23.7575 4.17965 22.4572 7.50345L0 64.6714H11.4973L18.0454 47.6942H42.9108L49.3594 64.4326L49.4589 64.6714H60.9562L38.499 7.50345H38.4857ZM21.2365 38.3862L30.4184 14.3899L39.6136 38.3862H21.2365Z"
                      fill="currentColor"
                    />
                  </svg>
                </div>
              </Link>
            </Button>
          </SidebarMenuItem>
        </SidebarMenu>

        <SidebarMenu>
          <SidebarMenuItem>
            <Button
              className="w-full justify-start gap-2 bg-slate-50 text-slate-900 group-data-[collapsible=icon]:pl-2 hover:bg-slate-200"
              size="sm"
              onClick={openCreateCollection}
            >
              <Plus className="size-4" />
              <span className="group-data-[collapsible=icon]:hidden">
                Create Collection
              </span>
            </Button>
          </SidebarMenuItem>
        </SidebarMenu>
      </SidebarHeader>

      <SidebarContent>
        <SidebarGroup>
          <SidebarGroupContent>
            <SidebarMenu>
              {navItems.map((item) => (
                <SidebarMenuItem key={item.title}>
                  <SidebarMenuButton
                    asChild
                    isActive={isActive(item.to)}
                    tooltip={item.title}
                  >
                    <Link to={item.to} params={{ orgSlug }}>
                      <item.icon />
                      <span>{item.title}</span>
                    </Link>
                  </SidebarMenuButton>
                </SidebarMenuItem>
              ))}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      </SidebarContent>

      <SidebarFooter>
        <SidebarMenu>
          <SidebarMenuItem>
            <UserAccountDropdown variant="sidebar" />
          </SidebarMenuItem>
        </SidebarMenu>
      </SidebarFooter>
      <SidebarRail />
    </Sidebar>
  );
}
