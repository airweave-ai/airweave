import{c as P,ap as Z,aq as ee,ar as ue,j as e,a as k,B as R,L as B,aE as Ue,aF as mt,d as xe,n as we,r as c,i as he,t as W,q as ne,a6 as ht,X as Pe,aG as X,af as K,ag as J,ah as G,u as Be,D as pt,o as ft,aH as gt,s as yt,v as bt,b as te,an as jt,T as Nt,V as vt,W as wt,$ as kt,a4 as Te,am as Ct,k as Ve,aI as St,as as _t,C as zt,aJ as Et,aK as Tt,aj as At,ak as Dt}from"./main-BEToz-TC.js";import{u as me}from"./api-form-CPp1CwpP.js";import{C as ae,A as Ke,b as Je,c as Ge,d as He,e as We,i as ye,f as Qe,g as Ye,h as Xe,E as Ae}from"./error-state-DJ8okmbQ.js";import{L as Mt}from"./loading-state-DlUdFJYL.js";import{L as se,u as Ze,d as $t,a as Rt}from"./collections-Yw3Eirdu.js";import{I as ie}from"./input-Dgezjod8.js";import{u as et}from"./use-is-dark-pSwRFwVX.js";import{a as le,e as qt,d as Lt,h as It,i as Ft,j as Ot}from"./sidebar-content-BALcDoUB.js";import{u as oe}from"./org-context-QNZ_DRQw.js";import{E as ke,P as Ut,T as tt,L as Pt}from"./trash-DC_b27ub.js";import{T as Ce}from"./trash-2-DNkcOHO8.js";import{A as Bt,F as Vt,S as Kt,M as Jt}from"./settings-CTXMjwWH.js";import{A as Gt}from"./arrow-right-CWnj4Tjf.js";import"./checkbox-CmSojv_w.js";import{E as Se}from"./empty-state-DKSl-bi2.js";import{C as _e}from"./use-docs-content-ogu5VP42.js";import{u as Ht}from"./use-keyboard-shortcut-DSl5K4r7.js";import{L as Wt}from"./layers-DhhXo1wF.js";import"./tabs-DYoc-HWa.js";const Qt=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Yt=P("arrow-up",Qt);const Xt=[["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}],["circle",{cx:"18.5",cy:"5.5",r:".5",fill:"currentColor",key:"lysivs"}],["circle",{cx:"11.5",cy:"11.5",r:".5",fill:"currentColor",key:"byv1b8"}],["circle",{cx:"7.5",cy:"16.5",r:".5",fill:"currentColor",key:"nkw3mc"}],["circle",{cx:"17.5",cy:"14.5",r:".5",fill:"currentColor",key:"1gjh6j"}],["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}]],Zt=P("chart-scatter",Xt);const es=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ts=P("chevron-up",es);const ss=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],rs=P("circle-check-big",ss);const ns=[["path",{d:"M12 6v6l1.56.78",key:"14ed3g"}],["path",{d:"M13.227 21.925a10 10 0 1 1 8.767-9.588",key:"jwkls1"}],["path",{d:"m14 18 4-4 4 4",key:"ftkppy"}],["path",{d:"M18 22v-8",key:"su0gjh"}]],as=P("clock-arrow-up",ns);const is=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],st=P("clock",is);const ls=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],os=P("funnel",ls);const cs=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]],ds=P("git-merge",cs);const us=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],xs=P("history",us);const ms=[["path",{d:"M3 5h6",key:"1ltk0q"}],["path",{d:"M3 12h13",key:"ppymz1"}],["path",{d:"M3 19h13",key:"bpdczq"}],["path",{d:"m16 8-3-3 3-3",key:"1pjpp6"}],["path",{d:"M21 19V7a2 2 0 0 0-2-2h-6",key:"4zzq67"}]],hs=P("list-start",ms);const ps=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],fs=P("play",ps);const gs=[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M17 8a1 1 0 0 1 1 1v4a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1z",key:"1xoxul"}],["path",{d:"M9 8V2",key:"14iosj"}]],ys=P("plug",gs);const bs=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ze=P("refresh-cw",bs);const js=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Ns=P("rotate-cw",js);const vs=[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["path",{d:"m8.5 8.5 5 5",key:"a8mexj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],ws=P("search-x",vs);const ks=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],rt=P("send",ks);const Cs=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Ss=P("settings-2",Cs);const _s=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],nt=P("square",_s);const zs=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Es=P("type",zs);async function Ts(t,r,s){const a=await fetch(`${Z}/source-connections`,{method:"POST",headers:ee(t,r),body:JSON.stringify(s)});if(!a.ok){const n=await ue(a,"Failed to create source connection");throw new Error(n)}return a.json()}async function As(t,r,s){const a=await fetch(`${Z}/source-connections/?collection=${s}`,{headers:ee(t,r)});if(!a.ok){const n=await ue(a,"Failed to fetch source connections");throw new Error(n)}return a.json()}async function De(t,r,s,a=!1){const n=a?`${Z}/source-connections/${s}?regenerate_auth_url=true`:`${Z}/source-connections/${s}`,i=await fetch(n,{headers:ee(t,r)});if(!i.ok){const l=await ue(i,"Failed to fetch source connection");throw new Error(l)}return i.json()}async function Ds(t,r,s){const a=await fetch(`${Z}/source-connections/${s}/run`,{method:"POST",headers:ee(t,r)});if(!a.ok){const n=await ue(a,"Failed to start sync");throw new Error(n)}return a.json()}async function Ms(t,r,s,a){const n=await fetch(`${Z}/source-connections/${s}/jobs/${a}/cancel`,{method:"POST",headers:ee(t,r)});if(!n.ok){const i=await ue(n,"Failed to cancel sync job");throw new Error(i)}}async function $s(t,r,s){const a=await fetch(`${Z}/source-connections/${s}`,{method:"DELETE",headers:ee(t,r)});if(!a.ok){const n=await ue(a,"Failed to delete source connection");throw new Error(n)}}function at({sourceName:t,sourceShortName:r,authenticationUrl:s,onRefreshUrl:a,isRefreshing:n,onDelete:i,className:l}){const o=le(r);return e.jsx("div",{className:k("rounded-lg border border-cyan-500/30 bg-cyan-500/5 p-6",l),children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"bg-background mb-4 flex size-16 items-center justify-center overflow-hidden rounded-lg border p-2",children:e.jsx("img",{src:o,alt:t,className:"size-full object-contain"})}),e.jsxs("h3",{className:"mb-2 text-lg font-semibold",children:["Connect to ",t]}),e.jsxs("p",{className:"text-muted-foreground mb-6 max-w-md text-sm",children:["This source requires authentication. Click the button below to authorize access to your ",t," data."]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-3",children:[s?e.jsx(R,{asChild:!0,children:e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ke,{className:"mr-2 size-4"}),"Authenticate with ",t]})}):e.jsxs(R,{disabled:!0,children:[e.jsx(B,{className:"mr-2 size-4 animate-spin"}),"Generating auth URL..."]}),a&&e.jsxs(R,{variant:"outline",onClick:a,disabled:n,children:[n?e.jsx(B,{className:"mr-2 size-4 animate-spin"}):e.jsx(ze,{className:"mr-2 size-4"}),"Refresh URL"]}),i&&e.jsxs(R,{variant:"outline",onClick:i,className:"text-destructive hover:bg-destructive/10 hover:text-destructive",children:[e.jsx(Ce,{className:"mr-2 size-4"}),"Remove"]})]})]})})}function Rs({fields:t,values:r,onChange:s}){const a=t.some(n=>n.required);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(se,{className:"text-xs tracking-wider text-gray-500 uppercase dark:text-gray-400",children:["Additional Configuration",!a&&" (optional)"]}),t.map(n=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(se,{className:"text-sm font-medium",children:[n.display_name||n.name,n.required&&e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),n.description&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:n.description}),e.jsx(ie,{value:Array.isArray(r[n.name])?r[n.name].join(", "):r[n.name]||"",onChange:i=>s(n.name,i.target.value),className:"border-gray-200 bg-white placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:placeholder:text-gray-500"})]},n.name))]})}function qs(t){return["password","token","secret","key"].some(r=>t.toLowerCase().includes(r))}function Ls({fields:t,values:r,onChange:s}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{className:"text-xs tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Credentials"}),t.map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(se,{className:"text-sm font-medium",children:[a.display_name||a.name,a.required&&e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),a.description&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:a.description}),e.jsx(ie,{type:qs(a.name)?"password":"text",value:r[a.name]||"",onChange:n=>s(a.name,n.target.value),className:"border-gray-200 bg-white placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:placeholder:text-gray-500"})]},a.name))]})}function Is({sourceShortName:t,sourceName:r,requiresByoc:s,useCustomOAuth:a,clientId:n,clientSecret:i,redirectUrl:l,onUseCustomOAuthChange:o,onClientIdChange:d,onClientSecretChange:u}){return e.jsxs("div",{className:"space-y-4",children:[s?e.jsx(Fs,{sourceShortName:t,sourceName:r,clientId:n,clientSecret:i,onClientIdChange:d,onClientSecretChange:u}):e.jsx(Os,{useCustomOAuth:a,clientId:n,clientSecret:i,onUseCustomOAuthChange:o,onClientIdChange:d,onClientSecretChange:u}),e.jsx(Us,{url:l})]})}function Fs({sourceShortName:t,sourceName:r,clientId:s,clientSecret:a,onClientIdChange:n,onClientSecretChange:i}){const l=`https://docs.airweave.ai/docs/connectors/${t.replace(/_/g,"-")}`;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-2 rounded-lg bg-blue-50 p-3 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400",children:[e.jsx(Ue,{className:"mt-0.5 h-4 w-4 flex-shrink-0"}),e.jsxs("p",{className:"text-sm",children:[r," requires you to provide your own OAuth application credentials. You'll need to create an OAuth app in ",r,"'s developer console."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Need help setting up OAuth?"}),e.jsxs("a",{href:l,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm font-medium text-blue-600 hover:underline dark:text-blue-400",children:["View documentation",e.jsx(ke,{className:"h-3 w-3"})]})]}),e.jsx(it,{clientId:s,clientSecret:a,onClientIdChange:n,onClientSecretChange:i,required:!0})]})}function Os({useCustomOAuth:t,clientId:r,clientSecret:s,onUseCustomOAuthChange:a,onClientIdChange:n,onClientSecretChange:i}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex cursor-pointer items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:l=>a(l.target.checked),className:"sr-only"}),e.jsx("div",{className:k("h-6 w-10 rounded-full transition-colors",t?"bg-blue-600":"bg-gray-200 dark:bg-gray-800"),children:e.jsx("div",{className:k("absolute top-0.5 left-0.5 h-5 w-5 rounded-full bg-white transition-transform",t&&"translate-x-4")})})]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Use custom OAuth credentials"})]}),t&&e.jsx("div",{className:"space-y-3 pl-13",children:e.jsx(it,{clientId:r,clientSecret:s,onClientIdChange:n,onClientSecretChange:i})})]})}function it({clientId:t,clientSecret:r,onClientIdChange:s,onClientSecretChange:a,required:n}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(se,{className:"text-sm font-medium",children:["Client ID ",n&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ie,{value:t,onChange:i=>s(i.target.value),placeholder:n?"Your OAuth Client ID":"Client ID",className:"border-gray-200 bg-white placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:placeholder:text-gray-500"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(se,{className:"text-sm font-medium",children:["Client Secret ",n&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ie,{type:"password",value:r,onChange:i=>a(i.target.value),placeholder:n?"Your OAuth Client Secret":"Client Secret",className:"border-gray-200 bg-white placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:placeholder:text-gray-500"})]})]})}function Us({url:t}){return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"text-xs tracking-wider text-gray-400 uppercase dark:text-gray-500",children:"Redirect URL"}),e.jsx(Ue,{className:"h-3 w-3 text-gray-400 dark:text-gray-600"})]}),e.jsx("div",{className:"rounded-lg border border-gray-100 bg-gray-50 px-3 py-2 font-mono text-xs text-gray-400 dark:border-gray-800 dark:bg-gray-900/50 dark:text-gray-500",children:t})]})}function Ne(){return`${window.location.origin}?oauth_return=true`}function Ps({collectionId:t,collectionName:r,sourceShortName:s,sourceName:a,connectionName:n,authMode:i,authFields:l,configFields:o,useCustomOAuth:d,clientId:u,clientSecret:m,onBack:h,onConnectionNameChange:p,onAuthModeChange:x,onAuthFieldChange:g,onConfigFieldChange:j,onUseCustomOAuthChange:v,onClientIdChange:_,onClientSecretChange:C,onSuccess:A,onCancel:E}){const T=et(),{getAccessTokenSilently:f}=xe(),{organization:b}=oe(),z=we(),[D,S]=c.useState(null),{data:N,isLoading:w}=he({queryKey:["source",b?.id,s],queryFn:async()=>{const $=await f();return qt($,b.id,s)},enabled:!!b&&!!s}),y=c.useMemo(()=>{if(!N?.auth_methods)return[];const $=[];return N.auth_methods.includes("direct")&&$.push("direct_auth"),(N.auth_methods.includes("oauth_browser")||N.auth_methods.includes("oauth_token"))&&$.push("oauth2"),$},[N]);c.useEffect(()=>{N&&!i&&y.length>0&&(y.includes("direct_auth")?x("direct_auth"):y.includes("oauth2")&&(x("oauth2"),N.requires_byoc&&v(!0)))},[N,i,y,x,v]);const q=me({mutationFn:async()=>{const $=await f();let O={};i==="direct_auth"?O={credentials:l}:i==="oauth2"&&(O={redirect_uri:Ne()},(N?.requires_byoc||d)&&(O.client_id=u,O.client_secret=m));const I={};for(const[H,M]of Object.entries(o))M&&(Array.isArray(M)?M.length>0:M!=="")&&(I[H]=M);return Ts($,b.id,{name:n.trim(),description:`${a} connection for ${r}`,short_name:s,readable_collection_id:t,authentication:O,config:Object.keys(I).length>0?I:void 0,sync_immediately:i==="direct_auth",redirect_url:Ne()})},onSuccess:$=>{z.invalidateQueries({queryKey:ne.sourceConnections.list(b.id,t)});const O=$.auth?.auth_url;O?(S(O),A($.id,O)):(W.success("Source connected successfully!"),A($.id))},onError:$=>{W.error("Failed to create connection",{description:$.message})}}),Q=c.useMemo(()=>{const $=n.trim();if(!$||$.length<4||$.length>42)return!1;if(i==="direct_auth"&&N?.auth_fields?.fields){const O=N.auth_fields.fields.filter(I=>I.required);for(const I of O)if(!l[I.name]?.trim())return!1}if(i==="oauth2"&&(N?.requires_byoc||d)&&(!u.trim()||!m.trim()))return!1;if(N?.config_fields?.fields){const O=N.config_fields.fields.filter(I=>I.required);for(const I of O){const H=o[I.name];if(Array.isArray(H)){if(H.length===0)return!1}else if(!H?.trim())return!1}}return!0},[n,i,l,o,N,d,u,m]),Y=c.useCallback(()=>{Q&&q.mutate()},[Q,q]);return D?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsx(at,{sourceName:a,sourceShortName:s,authenticationUrl:D})}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-4 dark:border-gray-800",children:e.jsx("button",{onClick:E,className:"text-sm font-medium text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:"Close"})})]}):w?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(B,{className:"text-muted-foreground h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:h,className:"rounded-lg p-1.5 text-gray-500 transition-colors hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800",children:e.jsx(Bt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:le(s,T?"dark":"light"),alt:a,className:"h-6 w-6 rounded"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Configure ",a]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Set up your connection settings"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto px-6 py-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{className:"text-xs tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Connection Name"}),e.jsx(ie,{value:n,onChange:$=>p($.target.value),placeholder:"Enter connection name",className:"border-gray-200 bg-white placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:placeholder:text-gray-500"}),n&&(n.length<4||n.length>42)&&e.jsx("p",{className:"text-xs text-amber-500",children:"Name must be between 4 and 42 characters"})]}),y.length>1&&e.jsx(Bs,{availableAuthMethods:y,selectedAuthMode:i,onAuthModeChange:x}),i==="direct_auth"&&N?.auth_fields?.fields&&e.jsx(Ls,{fields:N.auth_fields.fields,values:l,onChange:g}),i==="oauth2"&&e.jsx(Is,{sourceShortName:s,sourceName:a,requiresByoc:N?.requires_byoc??!1,useCustomOAuth:d,clientId:u,clientSecret:m,redirectUrl:Ne(),onUseCustomOAuthChange:v,onClientIdChange:_,onClientSecretChange:C}),N?.config_fields?.fields&&N.config_fields.fields.length>0&&e.jsx(Rs,{fields:N.config_fields.fields,values:o,onChange:j})]})}),e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 px-6 py-4 dark:border-gray-800",children:[e.jsx("button",{onClick:E,className:"text-sm font-medium text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel"}),e.jsx(R,{onClick:Y,disabled:!Q||q.isPending,className:k("min-w-[100px]",Q&&!q.isPending?"bg-blue-600 text-white hover:bg-blue-700":""),children:q.isPending?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create"})]})]})}function Bs({availableAuthMethods:t,selectedAuthMode:r,onAuthModeChange:s}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{className:"text-xs tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"Authentication Method"}),e.jsxs("div",{className:"flex gap-2",children:[t.includes("direct_auth")&&e.jsx("button",{onClick:()=>s("direct_auth"),className:k("flex-1 rounded-lg border px-4 py-2 text-sm font-medium transition-colors",r==="direct_auth"?"border-blue-500 bg-blue-50 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400":"border-gray-200 bg-white text-gray-700 hover:border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:border-gray-600"),children:"API Key / Credentials"}),t.includes("oauth2")&&e.jsx("button",{onClick:()=>s("oauth2"),className:k("flex-1 rounded-lg border px-4 py-2 text-sm font-medium transition-colors",r==="oauth2"?"border-blue-500 bg-blue-50 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400":"border-gray-200 bg-white text-gray-700 hover:border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:border-gray-600"),children:"OAuth"})]})]})}const Vs={notion:"Connect to Notion to sync pages, databases, and workspace content.",postgresql:"Connect to PostgreSQL to sync tables, views, schemas, and records.",jira:"Connect to Jira to sync issues, projects, and team workflows.",hubspot:"Connect to HubSpot to sync contacts, companies, deals, and CRM data.",google_calendar:"Connect to Google Calendar to sync events and scheduling data.",google_drive:"Connect to Google Drive to sync files, folders, and documents.",gmail:"Connect to Gmail to sync email threads and attachments.",confluence:"Connect to Confluence to sync pages, spaces, and documentation.",todoist:"Connect to Todoist to sync projects, tasks, and productivity data.",github:"Connect to GitHub to sync repositories and code files.",stripe:"Connect to Stripe to sync customers, transactions, and billing data.",dropbox:"Connect to Dropbox to sync files and cloud storage data.",asana:"Connect to Asana to sync workspaces, projects, and tasks.",outlook_calendar:"Connect to Outlook Calendar to sync events and meetings.",outlook_mail:"Connect to Outlook Mail to sync emails and folders.",onedrive:"Connect to OneDrive to sync files and cloud storage.",monday:"Connect to Monday to sync boards and project management data.",bitbucket:"Connect to Bitbucket to sync repositories and pull requests.",linear:"Connect to Linear to sync issues and engineering workflows.",slack:"Connect to Slack to sync messages and channel data."};function Ks({onSelectSource:t,onCancel:r}){const s=et(),{getAccessTokenSilently:a}=xe(),{organization:n}=oe(),[i,l]=c.useState(""),{data:o=[],isLoading:d}=he({queryKey:["sources",n?.id],queryFn:async()=>{const x=await a();return Lt(x,n.id)},enabled:!!n}),u=c.useMemo(()=>{if(!i)return o;const x=i.toLowerCase();return o.filter(g=>g.name.toLowerCase().includes(x)||g.short_name.toLowerCase().includes(x)||g.description?.toLowerCase().includes(x))},[o,i]),m=c.useMemo(()=>[...u].sort((x,g)=>x.name.localeCompare(g.name)),[u]),h=c.useCallback(x=>{t(x.short_name,x.name)},[t]),p=x=>Vs[x.short_name]||x.description||`Connect to ${x.name} to sync your data.`;return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"border-b px-6 py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Select a source"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Choose a data source to connect to your collection"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ht,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-gray-400 dark:text-gray-500"}),e.jsx(ie,{type:"text",placeholder:"Search sources...",value:i,onChange:x=>l(x.target.value),className:"border-gray-200 bg-white pr-8 pl-9 placeholder:text-gray-400 dark:border-gray-700 dark:bg-gray-800 dark:placeholder:text-gray-500",autoFocus:!0}),i&&e.jsx("button",{onClick:()=>l(""),className:"absolute top-1/2 right-2 -translate-y-1/2 rounded p-1 transition-colors hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(Pe,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:[m.length," ",m.length===1?"source":"sources"," available"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:d?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(B,{className:"text-muted-foreground h-8 w-8 animate-spin"})}):m.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:i?"No sources found":"No sources available"}),i&&e.jsx("button",{onClick:()=>l(""),className:"mt-2 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"Clear search"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-3 sm:grid-cols-4 lg:grid-cols-5",children:m.map(x=>e.jsx(X,{delayDuration:300,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsxs("button",{onClick:()=>h(x),className:"group flex flex-col items-center gap-2 rounded-lg border border-gray-200 bg-white p-4 transition-all hover:border-gray-300 hover:bg-gray-50 dark:border-gray-800 dark:bg-gray-900/50 dark:hover:border-gray-700 dark:hover:bg-gray-900",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center overflow-hidden rounded-md",children:e.jsx("img",{src:le(x.short_name,s?"dark":"light"),alt:x.name,className:"h-full w-full object-contain",onError:g=>{g.target.style.display="none";const j=g.target.parentElement;j&&(j.innerHTML=`<span class="flex h-full w-full items-center justify-center rounded-md ${s?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"} text-lg font-semibold">${x.name.charAt(0).toUpperCase()}</span>`)}})}),e.jsx("span",{className:"line-clamp-1 text-center text-xs font-medium text-gray-900 dark:text-white",children:x.name})]})}),e.jsx(G,{side:"top",className:"max-w-xs border border-gray-200 bg-white p-4 text-gray-900 shadow-lg dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:le(x.short_name,s?"dark":"light"),alt:x.name,className:"h-5 w-5 rounded-sm"}),e.jsx("span",{className:"text-sm font-semibold",children:x.name})]}),e.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:p(x)}),x.labels&&x.labels.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 pt-1",children:x.labels.map((g,j)=>e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-300",children:g},j))})]})})]})},x.short_name))})}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-4 dark:border-gray-800",children:e.jsx("button",{onClick:r,className:"text-sm font-medium text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancel"})})]})}function Js({collectionId:t,collectionName:r,sourceName:s,onClose:a}){const n=Be(),{getOrgSlug:i,organization:l}=oe(),o=()=>{if(l){const d=i(l);n({to:`/${d}/collections/${t}`})}a()};return e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-6 py-12",children:e.jsxs("div",{className:"max-w-sm space-y-6 text-center",children:[e.jsx("div",{className:"mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/30",children:e.jsx(rs,{className:"h-10 w-10 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Source connected!"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Your data is now syncing"})]}),e.jsx("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800/50",children:e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Collection"}),e.jsx("span",{className:"font-medium",children:r})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Source"}),e.jsx("span",{className:"font-medium",children:s})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Status"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"h-2 w-2 animate-pulse rounded-full bg-green-500"}),e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:"Syncing"})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(R,{onClick:o,className:"w-full bg-blue-600 text-white hover:bg-blue-700",children:["View Collection",e.jsx(Gt,{className:"ml-2 h-4 w-4"})]}),e.jsx("button",{onClick:a,className:"w-full rounded-lg px-4 py-2 text-sm font-medium text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-200",children:"Done"})]})]})})}function Gs({open:t,onOpenChange:r}){const{currentStep:s,collectionId:a,collectionName:n,selectedSourceShortName:i,selectedSourceName:l,connectionName:o,authMode:d,authFields:u,configFields:m,useCustomOAuth:h,clientId:p,clientSecret:x,customRedirectUrl:g,selectSource:j,setStep:v,goBack:_,setConnectionName:C,setAuthMode:A,setAuthField:E,setConfigField:T,setUseCustomOAuth:f,setClientId:b,setClientSecret:z,setCustomRedirectUrl:D,completeWithOAuth:S,completeWithoutOAuth:N,reset:w,close:y}=Ze(),q=c.useCallback(M=>{M||(y(),setTimeout(()=>{w()},300)),r(M)},[y,w,r]),Q=c.useCallback((M,F)=>{j(M,F)},[j]),Y=c.useCallback((M,F)=>{F?S(M,F):N(M)},[S,N]),$=c.useCallback(()=>{q(!1)},[q]),O=c.useCallback(()=>{_()},[_]),I=()=>{switch(s){case"source-select":return"max-w-4xl";case"source-config":case"oauth-pending":return"max-w-lg";case"success":return"max-w-md";default:return"max-w-2xl"}},H=()=>{if(!a||!n)return null;switch(s){case"source-select":return e.jsx(Ks,{onSelectSource:Q,onCancel:$});case"source-config":case"oauth-pending":return!i||!l?(v("source-select"),null):e.jsx(Ps,{collectionId:a,collectionName:n,sourceShortName:i,sourceName:l,connectionName:o,authMode:d,authFields:u,configFields:m,useCustomOAuth:h,clientId:p,clientSecret:x,customRedirectUrl:g,onBack:O,onConnectionNameChange:C,onAuthModeChange:A,onAuthFieldChange:E,onConfigFieldChange:T,onUseCustomOAuthChange:f,onClientIdChange:b,onClientSecretChange:z,onCustomRedirectUrlChange:D,onSuccess:Y,onCancel:$});case"success":return e.jsx(Js,{collectionId:a,collectionName:n,sourceName:l||"Source",onClose:$});default:return null}};return e.jsx(pt,{open:t,onOpenChange:q,children:e.jsxs(ft,{className:`${I()} h-[600px] overflow-hidden p-0`,onPointerDownOutside:M=>{s==="oauth-pending"&&M.preventDefault()},onEscapeKeyDown:M=>{s==="oauth-pending"&&M.preventDefault()},children:[e.jsxs(gt,{children:[e.jsx(yt,{children:"Add Source to Collection"}),e.jsx(bt,{children:"Select and configure a data source to connect to your collection"})]}),H()]})})}const Hs={ACTIVE:{label:"Active",className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},NEEDS_SOURCE:{label:"Needs Source",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"},ERROR:{label:"Error",className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}};function Ws({status:t}){const r=Hs[t]||{label:t,className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-400"};return e.jsx("span",{className:k("inline-flex items-center rounded-md px-2 py-1 text-xs font-medium",r.className),children:r.label})}function Qs({collection:t,sourceConnections:r,onReload:s,onDelete:a,onSaveName:n}){const[i,l]=c.useState(!1),[o,d]=c.useState(!1),u=c.useRef(null),m=c.useCallback(()=>{l(!0),setTimeout(()=>{if(u.current&&t){u.current.innerText=t.name;const x=document.createRange(),g=window.getSelection(),j=u.current.firstChild||u.current,v=u.current.innerText.length;x.setStart(j,v),x.setEnd(j,v),g&&(g.removeAllRanges(),g.addRange(x)),u.current.focus()}},0)},[t]),h=c.useCallback(async()=>{const x=u.current?.innerText.trim()||"";if(!x||x===t?.name){l(!1);return}try{await n?.(x),l(!1),W.success("Collection name updated")}catch{W.error("Failed to update collection name"),l(!1)}},[t,n]),p=c.useCallback(()=>{t?.readable_id&&(navigator.clipboard.writeText(t.readable_id),d(!0),setTimeout(()=>d(!1),1500),W.success("ID copied to clipboard"))},[t]);return e.jsxs("div",{className:"flex w-full items-center justify-between py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center justify-start",style:{minWidth:"3.5rem"},children:[r.slice(0,3).map((x,g)=>e.jsx("div",{className:"bg-background flex size-12 items-center justify-center overflow-hidden rounded-md border p-1",style:{marginLeft:g>0?`-${Math.min(g*8,24)}px`:"0px",zIndex:3-g},children:e.jsx("img",{src:le(x.short_name),alt:x.name,className:"size-auto max-h-full max-w-full object-contain"})},x.id)),r.length>3&&e.jsxs("div",{className:"text-muted-foreground ml-2 text-sm font-medium",children:["+",r.length-3]})]}),e.jsxs("div",{className:"flex flex-col justify-center",children:[i?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{ref:u,contentEditable:!0,className:"text-foreground border-border/40 rounded border p-1 pr-3 pl-0 text-3xl font-bold tracking-tight transition-all duration-150 outline-none",onKeyDown:x=>{x.key==="Enter"&&(x.preventDefault(),h()),x.key==="Escape"&&(x.preventDefault(),l(!1))},onBlur:h})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-foreground py-1 pl-0 text-2xl font-bold tracking-tight",children:t.name}),e.jsx(R,{variant:"ghost",size:"icon",className:"text-muted-foreground hover:text-foreground size-6",onClick:m,children:e.jsx(Ut,{className:"size-3"})}),t.status&&e.jsx(Ws,{status:t.status})]}),e.jsxs("p",{className:"text-muted-foreground group relative flex items-center text-sm",children:[t.readable_id,e.jsx("button",{className:"ml-1.5 opacity-0 transition-opacity group-hover:opacity-100 focus:opacity-100 focus:outline-none",onClick:p,title:"Copy ID",children:o?e.jsx(te,{className:"text-muted-foreground size-3.5 transition-all"}):e.jsx(ae,{className:"text-muted-foreground size-3.5 transition-all"})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(X,{children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsx(R,{variant:"outline",size:"icon",className:"size-8",onClick:s,children:e.jsx(Ns,{className:"size-3"})})}),e.jsx(G,{children:e.jsx("p",{children:"Reload page"})})]})}),e.jsx(X,{children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsx(R,{variant:"outline",size:"icon",className:"size-8",onClick:a,children:e.jsx(tt,{className:"size-3"})})}),e.jsx(G,{children:e.jsx("p",{children:"Delete collection"})})]})})]})]})}function Ys({open:t,onOpenChange:r,onConfirm:s,collectionReadableId:a,isDeleting:n}){const[i,l]=c.useState(""),o=i===a;return c.useEffect(()=>{t||l("")},[t]),e.jsx(Ke,{open:t,onOpenChange:r,children:e.jsxs(Je,{className:"max-w-md",children:[e.jsxs(Ge,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-destructive/10 flex size-10 flex-shrink-0 items-center justify-center rounded-full",children:e.jsx(jt,{className:"text-destructive size-5"})}),e.jsxs("div",{children:[e.jsx(He,{className:"text-foreground text-lg font-semibold",children:"Delete Collection"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm",children:"This action cannot be undone"})]})]}),e.jsxs(We,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-destructive/5 border-destructive/20 rounded-lg border p-4",children:[e.jsx("p",{className:"text-foreground mb-3 font-medium",children:"This will permanently delete:"}),e.jsxs("ul",{className:"text-muted-foreground space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"bg-destructive/60 mt-2 size-1.5 flex-shrink-0 rounded-full"}),e.jsx("span",{children:"The collection and all its source connections"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"bg-destructive/60 mt-2 size-1.5 flex-shrink-0 rounded-full"}),e.jsx("span",{children:"All synced data from the knowledge base"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"bg-destructive/60 mt-2 size-1.5 flex-shrink-0 rounded-full"}),e.jsx("span",{children:"All sync history and configuration"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"confirm-delete",className:"text-foreground mb-2 block text-sm font-medium",children:["Type"," ",e.jsx("span",{className:"bg-destructive/10 text-destructive rounded px-1.5 py-0.5 font-mono font-semibold",children:a})," ","to confirm deletion"]}),e.jsx(ie,{id:"confirm-delete",value:i,onChange:d=>l(d.target.value),className:k("w-full transition-colors",o&&i.length>0?"border-green-500 focus:border-green-500 focus:ring-green-500/20":i.length>0?"border-destructive focus:border-destructive focus:ring-destructive/20":""),placeholder:a})]}),i.length>0&&e.jsx("div",{className:"flex items-center gap-2 text-sm",children:o?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"size-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Confirmation matches"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"text-destructive size-4"}),e.jsx("span",{className:"text-destructive",children:"Confirmation does not match"})]})})]})]})]}),e.jsxs(Qe,{className:"gap-3",children:[e.jsx(Ye,{className:"flex-1",children:"Cancel"}),e.jsxs(Xe,{onClick:s,disabled:!o||n,className:k("bg-destructive text-destructive-foreground hover:bg-destructive/90 flex-1","disabled:cursor-not-allowed disabled:opacity-50","transition-all duration-200"),children:[n?e.jsx(B,{className:"mr-2 size-4 animate-spin"}):e.jsx(tt,{className:"mr-2 size-4"}),"Delete Collection"]})]})]})})}function Xs({entityStates:t=[],isRunning:r,isPending:s,onStartSync:a,className:n}){const i=d=>d.replace(/Entity$/,"").replace(/([A-Z])/g," $1").trim(),l=d=>{switch(d){case"syncing":return e.jsx("span",{className:"inline-flex size-2 animate-pulse rounded-full bg-blue-500"});case"synced":return e.jsx("span",{className:"inline-flex size-2 rounded-full bg-green-500"});case"failed":return e.jsx("span",{className:"inline-flex size-2 rounded-full bg-red-500"});default:return e.jsx("span",{className:"inline-flex size-2 rounded-full bg-gray-400"})}};if(t.length===0)return e.jsx(Se,{icon:e.jsx(Vt,{}),title:"No entities synced",description:"Start a sync to begin indexing your data",className:k("rounded-lg border-2 border-dashed py-8",n),children:a&&e.jsx(R,{variant:"outline",size:"sm",onClick:a,disabled:r||s,children:r||s?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 size-4 animate-spin"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"mr-2 size-4"}),"Start Sync"]})})});const o=t.reduce((d,u)=>d+u.total_count,0);return e.jsxs("div",{className:k("space-y-3",n),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total entities: "}),e.jsx("span",{className:"font-semibold",children:o.toLocaleString()})]}),(r||s)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400",children:[e.jsx(B,{className:"size-4 animate-spin"}),e.jsx("span",{children:"Syncing..."})]})]}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:t.map(d=>e.jsxs("div",{className:"bg-card flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l(d.sync_status),e.jsx("span",{className:"text-sm font-medium",children:i(d.entity_type)})]}),e.jsx("span",{className:"text-muted-foreground text-sm",children:d.total_count.toLocaleString()})]},d.entity_type))})]})}function Me({open:t,onOpenChange:r,onConfirm:s,sourceName:a,isDeleting:n,hasData:i=!0}){return e.jsx(Ke,{open:t,onOpenChange:r,children:e.jsxs(Je,{children:[e.jsxs(Ge,{children:[e.jsx(He,{children:"Delete Source Connection"}),e.jsxs(We,{children:['Are you sure you want to delete "',a,'"?',i?" This will permanently remove all synced data from this source.":" This will permanently remove this connection."]})]}),e.jsxs(Qe,{children:[e.jsx(Ye,{children:"Cancel"}),e.jsxs(Xe,{onClick:s,disabled:n,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[n?e.jsx(B,{className:"mr-2 size-4 animate-spin"}):e.jsx(Ce,{className:"mr-2 size-4"}),"Delete"]})]})]})})}function Zs(){return e.jsx("div",{className:"rounded-lg border border-blue-800/30 bg-blue-900/10 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(rt,{className:"mt-0.5 size-5 text-blue-400"}),e.jsx("div",{className:"flex-1 space-y-2",children:e.jsx("p",{className:"text-sm text-blue-200/80",children:"This source searches the data at query time instead of syncing and indexing it beforehand."})})]})})}function er({error:t,className:r}){return e.jsx("div",{className:k("border-destructive/50 bg-destructive/10 rounded-lg border p-4",r),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ye,{className:"text-destructive mt-0.5 size-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("p",{className:"text-destructive text-sm font-medium",children:"Sync Failed"}),e.jsx("p",{className:"text-destructive/80 text-sm",children:t})]})]})})}function tr({isFederatedSource:t,syncState:r,isSyncing:s,entityCount:a,statusDisplay:n,scheduleCron:i,scheduleNextRun:l,lastSyncTime:o,onSync:d,onCancelSync:u,onDelete:m,isSyncPending:h,isCancelPending:p}){return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[!t&&e.jsxs("div",{className:"bg-card flex h-8 min-w-[90px] items-center gap-2 rounded-md border px-3 py-1.5 shadow-sm",children:[e.jsx("span",{className:"text-muted-foreground/60 text-[10px] font-medium tracking-wider uppercase",children:"ENTITIES"}),e.jsx("span",{className:"text-foreground text-xs font-semibold",children:a.toLocaleString()})]}),e.jsxs("div",{className:k("flex h-8 min-w-[90px] items-center gap-2 rounded-md border px-3 py-1.5 shadow-sm",s?"border-blue-700/50 bg-blue-900/30":"border-border bg-card"),children:[e.jsx("span",{className:"text-muted-foreground/60 text-[10px] font-medium tracking-wider uppercase",children:"STATUS"}),e.jsxs("div",{className:"flex items-center gap-1",children:[n.icon==="loader"?e.jsx(B,{className:"size-3 animate-spin text-blue-500"}):e.jsx("span",{className:k("inline-flex size-2 rounded-full",n.color)}),e.jsx("span",{className:k("text-xs font-medium capitalize",s?"text-blue-400":"text-foreground"),children:n.text})]})]}),!t&&i&&e.jsx(X,{delayDuration:100,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsxs("div",{className:"bg-card flex h-8 min-w-[100px] cursor-help items-center gap-2 rounded-md border px-3 py-1.5 shadow-sm",children:[e.jsx("span",{className:"text-muted-foreground/60 text-[10px] font-medium tracking-wider uppercase",children:"SCHEDULE"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"text-muted-foreground size-3"}),e.jsx("span",{className:"text-foreground text-xs font-medium",children:i})]})]})}),e.jsx(G,{children:e.jsxs("p",{className:"text-xs",children:["Next run: ",l||"Not scheduled"]})})]})}),!t&&!s&&o&&e.jsxs("div",{className:"bg-card flex h-8 min-w-[100px] items-center gap-2 rounded-md border px-3 py-1.5 shadow-sm",children:[e.jsx("span",{className:"text-muted-foreground/60 text-[10px] font-medium tracking-wider uppercase",children:"LAST SYNC"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{className:"text-muted-foreground size-3"}),e.jsx("span",{className:"text-foreground text-xs font-medium",children:o})]})]}),t&&e.jsx(X,{delayDuration:100,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsxs("div",{className:"flex h-8 cursor-help items-center gap-2 rounded-md border border-blue-800/30 bg-blue-900/20 px-3 py-1.5 shadow-sm",children:[e.jsx("span",{className:"text-muted-foreground/60 text-[10px] font-medium tracking-wider uppercase",children:"MODE"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(rt,{className:"size-3 text-blue-500"}),e.jsx("span",{className:"text-xs font-medium text-blue-400",children:"Federated search"})]})]})}),e.jsx(G,{children:e.jsx("p",{className:"max-w-[240px] text-xs",children:"Data is queried in real-time when you search instead of being synced and indexed."})})]})})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[!t&&e.jsx(X,{delayDuration:100,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsx(R,{variant:"outline",size:"icon",className:"size-8",onClick:()=>{r==="IDLE"?d():r==="SYNCING"&&u()},disabled:r==="CANCELLING"||h||p,children:r==="CANCELLING"||p?e.jsx(B,{className:"size-3 animate-spin text-orange-500"}):r==="SYNCING"?e.jsx(nt,{className:"size-3 text-red-500"}):h?e.jsx(B,{className:"size-3 animate-spin"}):e.jsx(ze,{className:"size-3"})})}),e.jsx(G,{children:r==="CANCELLING"?"Cancelling sync...":r==="SYNCING"?"Cancel sync":"Refresh data"})]})}),e.jsxs(Nt,{children:[e.jsx(vt,{asChild:!0,children:e.jsx(R,{variant:"outline",size:"icon",className:"size-8",children:e.jsx(Kt,{className:"size-3"})})}),e.jsx(wt,{align:"end",children:e.jsxs(kt,{onClick:m,className:"text-destructive focus:text-destructive",children:[e.jsx(Ce,{className:"mr-2 size-4"}),"Delete Connection"]})})]})]})]})}function sr(t){if(!t)return null;const s=t.endsWith("Z")||t.match(/[T\s]\d{2}:\d{2}:\d{2}(?:\.\d+)?[+-]\d{2}:?\d{2}$/)?t:`${t}Z`,a=new Date(s),i=new Date().getTime()-a.getTime(),l=Math.floor(i/(1e3*60)),o=Math.floor(i/(1e3*60*60)),d=Math.floor(i/(1e3*60*60*24));return d>0?`${d}d ago`:o>0?`${o}h ago`:l>0?`${l}m ago`:"Just now"}function rr(t,r,s,a){return t?{text:"Not Authenticated",color:"bg-cyan-500",icon:null}:r?{text:"Ready",color:"bg-green-500",icon:null}:s==="CANCELLING"?{text:"Cancelling",color:"bg-orange-500 animate-pulse",icon:"loader"}:a==="failed"?{text:"Failed",color:"bg-red-500",icon:null}:a==="completed"?{text:"Completed",color:"bg-green-500",icon:null}:a==="cancelled"?{text:"Cancelled",color:"bg-gray-500",icon:null}:a==="running"||a==="in_progress"?{text:"Syncing",color:"bg-blue-500 animate-pulse",icon:"loader"}:a==="pending"||a==="created"?{text:"Pending",color:"bg-yellow-500 animate-pulse",icon:"loader"}:{text:"Ready",color:"bg-gray-400",icon:null}}function nr({sourceConnection:t,onConnectionDeleted:r,onConnectionUpdated:s}){const{getAccessTokenSilently:a}=xe(),{organization:n}=oe(),i=we(),[l,o]=c.useState(!1),[d,u]=c.useState(!1);if(!n)throw new Error("Organization context is required");const m=n.id,{data:h}=he({queryKey:ne.sourceConnections.detail(m,t.id),queryFn:async()=>{const w=await a();return De(w,m,t.id)},initialData:t,refetchOnMount:!0,staleTime:0}),p=h||t,x=p.federated_search===!0,g=p.status==="pending_auth"||!p.auth?.authenticated,j=p.last_sync_job,v=j?.status,_=c.useMemo(()=>v==="cancelling"?"CANCELLING":["running","in_progress","pending","created"].includes(v||"")?"SYNCING":"IDLE",[v]),C=v==="running"||v==="in_progress",A=v==="pending"||v==="created",E=_!=="IDLE",T=me({mutationFn:async()=>{const w=await a();return Ds(w,m,p.id)},onSuccess:()=>{W.success("Sync started"),s?.()},onError:w=>{W.error(w instanceof Error?w.message:"Failed to start sync")}}),f=me({mutationFn:async()=>{const w=await a();if(j?.id)return Ms(w,m,p.id,j.id)},onSuccess:()=>{W.success("Cancellation requested"),s?.()},onError:w=>{W.error(w instanceof Error?w.message:"Failed to cancel sync")}}),b=me({mutationFn:async()=>{const w=await a();return $s(w,m,p.id)},onSuccess:()=>{W.success("Source connection deleted"),o(!1),i.invalidateQueries({queryKey:ne.sourceConnections.all(m,p.readable_collection_id)}),r?.()},onError:w=>{W.error(w instanceof Error?w.message:"Failed to delete source connection")}}),z=c.useCallback(async()=>{u(!0);try{const w=await a();await De(w,m,t.id,!0),W.success("Authentication URL refreshed"),i.invalidateQueries({queryKey:ne.sourceConnections.detail(m,t.id)}),s?.()}catch(w){W.error(w instanceof Error?w.message:"Failed to refresh authentication URL")}finally{u(!1)}},[a,m,t.id,i,s]),D=rr(g,x,_,v),S=sr(p.last_sync_job?.started_at),N=p.entities?Object.entries(p.entities.by_type).map(([w,y])=>({entity_type:w,total_count:y.count,last_updated_at:y.last_updated,sync_status:y.sync_status})):[];return g?e.jsxs(e.Fragment,{children:[e.jsx(at,{sourceName:p.name,sourceShortName:p.short_name,authenticationUrl:p.auth?.auth_url,onRefreshUrl:z,isRefreshing:d,onDelete:()=>o(!0)}),e.jsx(Me,{open:l,onOpenChange:o,onConfirm:()=>b.mutate(),sourceName:p.name,isDeleting:b.isPending,hasData:!1})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(tr,{isFederatedSource:x,syncState:_,isSyncing:E,entityCount:p.entities?.total_entities||0,statusDisplay:D,scheduleCron:p.schedule?.cron,scheduleNextRun:p.schedule?.next_run,lastSyncTime:S,onSync:()=>T.mutate(),onCancelSync:()=>f.mutate(),onDelete:()=>o(!0),isSyncPending:T.isPending,isCancelPending:f.isPending}),!x&&j?.status==="failed"&&e.jsx(er,{error:j.error||"The last sync failed. Check the logs for more details."}),x&&e.jsx(Zs,{}),!x&&e.jsx(Xs,{entityStates:N,isRunning:C,isPending:A,onStartSync:()=>T.mutate()}),e.jsx(Me,{open:l,onOpenChange:o,onConfirm:()=>b.mutate(),sourceName:p.name,isDeleting:b.isPending,hasData:!0})]})}function ar(t){const r=t.federated_search===!0;let s="bg-gray-400",a="unknown",n=!1;if(r)switch(t.status){case"pending_auth":s="bg-cyan-500",a="Authentication required";break;case"error":s="bg-red-500",a="Connection error";break;case"inactive":s="bg-gray-400",a="Inactive";break;default:s="bg-green-500",a="Ready for real-time search";break}else switch(t.status){case"pending_auth":s="bg-cyan-500",a="Authentication required";break;case"syncing":s="bg-blue-500",a="Syncing",n=!0;break;case"error":s="bg-red-500",a="Sync failed";break;case"active":s="bg-green-500",a="Active";break;case"inactive":s="bg-gray-400",a="Inactive";break;default:s="bg-gray-400",a="Unknown"}return e.jsx("span",{className:k("inline-flex size-2 rounded-full opacity-80",s,n&&"animate-pulse"),title:a})}function ir({sourceConnections:t,selectedConnectionId:r,onSelectConnection:s,onAddSource:a}){return t.length===0?e.jsx(Se,{icon:e.jsx(ys,{strokeWidth:1.5}),title:"No sources connected",description:"Connect your first data source to start syncing and searching your data",className:"rounded-lg border-2 border-dashed py-12",children:e.jsxs(R,{variant:"outline",onClick:a,className:"border-blue-500 bg-blue-50 text-blue-600 hover:border-blue-600 hover:bg-blue-100 dark:border-blue-500 dark:bg-blue-500/20 dark:text-blue-400 dark:hover:border-blue-400 dark:hover:bg-blue-500/30",children:[e.jsx(Te,{className:"mr-1.5 size-4",strokeWidth:2}),"Connect a source"]})}):e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.map(n=>e.jsxs("div",{className:k("flex h-10 cursor-pointer items-center gap-2 overflow-hidden rounded-md border px-3 py-2 transition-all",r===n.id?"border-blue-500 bg-blue-500/10 shadow-lg ring-2 shadow-blue-500/20 ring-blue-500/30":"border-border hover:bg-muted"),onClick:()=>s(n.id),children:[ar(n),e.jsx("div",{className:"flex size-5 flex-shrink-0 items-center justify-center overflow-hidden rounded-md",children:e.jsx("img",{src:le(n.short_name),alt:n.name,className:"size-5 object-contain"})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("span",{className:"text-foreground block truncate text-sm font-medium",children:n.name})}),n.auth?.authenticated&&!n.federated_search&&(n.entities?.total_entities??0)>=0&&e.jsx("span",{className:"text-muted-foreground ml-1 flex-shrink-0 text-xs tabular-nums",children:(n.entities?.total_entities??0).toLocaleString()})]},n.id)),e.jsx(X,{delayDuration:100,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsxs("div",{className:k("flex h-10 cursor-pointer items-center gap-2 overflow-hidden rounded-md border border-dashed px-3 py-2 transition-all","border-blue-500/30 bg-blue-500/5 hover:border-blue-400/40 hover:bg-blue-500/15"),onClick:a,children:[e.jsx(Te,{className:"size-5 text-blue-500",strokeWidth:1.5}),e.jsx("span",{className:"text-foreground text-sm font-medium",children:"Add Source"})]})}),e.jsx(G,{children:e.jsx("p",{children:"Add a new source to this collection"})})]})})]})}function lr({className:t}){return e.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M11.914 0C5.82 0 6.2 2.656 6.2 2.656l.007 2.752h5.814v.826H3.9S0 5.789 0 11.969c0 6.18 3.403 5.96 3.403 5.96h2.03v-2.867s-.109-3.42 3.35-3.42h5.766s3.24.052 3.24-3.148V3.202S18.28 0 11.914 0zM8.708 1.85c.578 0 1.048.473 1.048 1.053s-.47 1.052-1.048 1.052c-.579 0-1.048-.473-1.048-1.052 0-.58.47-1.053 1.048-1.053z"}),e.jsx("path",{d:"M12.086 24c6.093 0 5.713-2.656 5.713-2.656l-.007-2.752h-5.814v-.826h8.121s3.9.445 3.9-5.735c0-6.18-3.402-5.96-3.402-5.96h-2.03v2.867s.109 3.42-3.35 3.42H9.45s-3.24-.052-3.24 3.148v5.292S5.72 24 12.086 24zm3.206-1.85c-.579 0-1.048-.473-1.048-1.053s.47-1.052 1.048-1.052c.578 0 1.048.473 1.048 1.052 0 .58-.47 1.053-1.048 1.053z"})]})}function or({className:t}){return e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M11.998 24c-.321 0-.641-.084-.922-.247l-2.936-1.737c-.438-.245-.224-.332-.08-.383.585-.203.703-.25 1.328-.604.066-.037.152-.023.22.017l2.256 1.339a.29.29 0 00.272 0l8.795-5.076a.277.277 0 00.134-.238V6.921a.282.282 0 00-.137-.242l-8.791-5.072a.278.278 0 00-.271 0L3.075 6.68a.281.281 0 00-.139.24v10.15c0 .099.053.19.137.239l2.409 1.392c1.307.654 2.108-.116 2.108-.89V7.787c0-.142.114-.253.256-.253h1.115c.139 0 .255.112.255.253v10.021c0 1.745-.95 2.745-2.604 2.745-.509 0-.909 0-2.026-.55l-2.304-1.326A1.85 1.85 0 011.36 17.07V6.921c0-.679.362-1.312.949-1.653l8.795-5.082a1.929 1.929 0 011.891 0l8.794 5.082a1.85 1.85 0 01.951 1.653v10.15a1.852 1.852 0 01-.951 1.652l-8.794 5.078c-.28.163-.599.247-.92.247"})})}function cr({className:t}){return e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:t,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})})}function dr({collectionReadableId:t,query:r,searchConfig:s,filter:a,apiKey:n="YOUR_API_KEY"}){const[i,l]=c.useState("rest"),[o,d]=c.useState(!1),u=c.useMemo(()=>{const h=`${Z}/collections/${t}/search`,p=r||"Ask a question about your data",x=y=>y.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),g=y=>y.replace(/\\/g,"\\\\").replace(/"/g,'\\"');let j=null;if(a)try{j=JSON.parse(a)}catch{j=null}const v={query:p,retrieval_strategy:s?.search_method||"hybrid",expand_query:s?.expansion_strategy!=="no_expansion",...j?{filter:j}:{},interpret_filters:s?.enable_query_interpretation||!1,temporal_relevance:s?.recency_bias??.3,rerank:s?.enable_reranking??!0,generate_answer:s?.response_type==="completion",limit:20,offset:0},_=JSON.stringify(v,null,2).split(`
`).map((y,q,Q)=>q===0?y:(q===Q.length-1,"  "+y)).join(`
`),A=`${s?.enable_query_interpretation?`# Note: interpret_filters is enabled, which may automatically add
# additional filters extracted from your natural language query.
# The filter shown below is your manual filter only.

`:""}curl -X 'POST' \\
  '${h}' \\
  -H 'accept: application/json' \\
  -H 'x-api-key: ${n}' \\
  -H 'Content-Type: application/json' \\
  -d '${_}'`,E=j?JSON.stringify(j,null,4).split(`
`).map((y,q)=>q===0?y:"        "+y).join(`
`):null,T=[`        query="${g(p)}"`,`        retrieval_strategy=RetrievalStrategy.${(s?.search_method||"hybrid").toUpperCase()}`,`        expand_query=${s?.expansion_strategy!=="no_expansion"?"True":"False"}`,...E?[`        filter=${E}`]:[],`        interpret_filters=${s?.enable_query_interpretation?"True":"False"}`,`        temporal_relevance=${s?.recency_bias??0}`,`        rerank=${s?.enable_reranking??!0?"True":"False"}`,`        generate_answer=${s?.response_type==="completion"?"True":"False"}`,"        limit=1000","        offset=0"],b=`${s?.enable_query_interpretation?`# Note: interpret_filters is enabled, which may automatically add
# additional filters extracted from your natural language query.
# The filter shown below is your manual filter only.

`:""}from airweave import AirweaveSDK, SearchRequest, RetrievalStrategy

client = AirweaveSDK(
    api_key="${n}",
)

result = client.collections.search(
    readable_id="${t}",
    request=SearchRequest(
${T.join(`,
`)}
    ),
)

print(result.completion)  # AI-generated answer (if generate_answer=True)
print(len(result.results))  # Number of results`,z=j?JSON.stringify(j,null,4).split(`
`).map((y,q)=>q===0?y:"            "+y).join(`
`):null,D=[`            query: "${x(p)}"`,`            retrievalStrategy: "${s?.search_method||"hybrid"}"`,`            expandQuery: ${s?.expansion_strategy!=="no_expansion"}`,...z?[`            filter: ${z}`]:[],`            interpretFilters: ${s?.enable_query_interpretation||!1}`,`            temporalRelevance: ${s?.recency_bias??0}`,`            rerank: ${s?.enable_reranking??!0}`,`            generateAnswer: ${s?.response_type==="completion"}`,"            limit: 1000","            offset: 0"],N=`${s?.enable_query_interpretation?`// Note: interpretFilters is enabled, which may automatically add
// additional filters extracted from your natural language query.
// The filter shown below is your manual filter only.

`:""}import { AirweaveSDKClient } from "@airweave/sdk";

const client = new AirweaveSDKClient({ apiKey: "${n}" });

const result = await client.collections.search("${t}", {
    request: {
${D.join(`,
`)}
    }
});

console.log(result.completion);  // AI-generated answer (if generateAnswer=true)
console.log(result.results.length);  // Number of results`,w=`{
  "mcpServers": {
    "airweave-${t}": {
      "command": "npx",
      "args": ["airweave-mcp-search"],
      "env": {
        "AIRWEAVE_API_KEY": "${n}",
        "AIRWEAVE_COLLECTION": "${t}",
        "AIRWEAVE_BASE_URL": "${Z}"
      }
    }
  }
}`;return{curl:A,python:b,node:N,mcp:w}},[t,n,s,r,a]),m=async()=>{const h={rest:u.curl,python:u.python,node:u.node,mcp:u.mcp};await navigator.clipboard.writeText(h[i]),d(!0),setTimeout(()=>d(!1),1500)};return e.jsx("div",{className:"mb-6 w-full",children:e.jsxs("div",{className:"overflow-hidden rounded-lg border border-slate-700 bg-slate-900",children:[e.jsxs("div",{className:"flex w-fit space-x-1 overflow-x-auto border-b border-slate-700 p-2",children:[e.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>l("rest"),className:k("flex items-center gap-2 rounded-md",i==="rest"?"bg-slate-800 text-slate-200":"text-slate-400 hover:bg-slate-800/80 hover:text-slate-200"),children:[e.jsx(Ct,{className:"size-4"}),e.jsx("span",{children:"cURL"})]}),e.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>l("python"),className:k("flex items-center gap-2 rounded-md",i==="python"?"bg-slate-800 text-slate-200":"text-slate-400 hover:bg-slate-800/80 hover:text-slate-200"),children:[e.jsx(lr,{className:"size-4"}),e.jsx("span",{children:"Python"})]}),e.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>l("node"),className:k("flex items-center gap-2 rounded-md",i==="node"?"bg-slate-800 text-slate-200":"text-slate-400 hover:bg-slate-800/80 hover:text-slate-200"),children:[e.jsx(or,{className:"size-4"}),e.jsx("span",{children:"Node.js"})]}),e.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>l("mcp"),className:k("flex items-center gap-2 rounded-md",i==="mcp"?"bg-slate-800 text-slate-200":"text-slate-400 hover:bg-slate-800/80 hover:text-slate-200"),children:[e.jsx(cr,{className:"size-4"}),e.jsx("span",{children:"MCP"})]})]}),e.jsxs("div",{className:"relative h-[460px]",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-800 px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:k("rounded px-1.5 py-0.5 text-xs text-white",i==="rest"&&"bg-amber-600",i==="python"&&"bg-blue-600",i==="node"&&"bg-blue-600",i==="mcp"&&"bg-purple-600"),children:[i==="rest"&&"POST",i==="python"&&"SDK",i==="node"&&"SDK",i==="mcp"&&"CONFIG"]}),e.jsxs("span",{className:"text-xs font-medium text-slate-300",children:[i==="rest"&&`/collections/${t}/search`,i==="python"&&"AirweaveSDK",i==="node"&&"AirweaveSDKClient",i==="mcp"&&"MCP Configuration"]})]}),e.jsx(R,{variant:"ghost",size:"sm",className:"size-6 p-0 text-slate-400 hover:text-white",onClick:m,children:o?e.jsx(te,{className:"size-3"}):e.jsx(ae,{className:"size-3"})})]}),e.jsx("div",{className:"h-[calc(100%-88px)] overflow-auto bg-black px-4 py-3",children:e.jsxs("pre",{className:"font-mono text-xs text-slate-300",children:[i==="rest"&&u.curl,i==="python"&&u.python,i==="node"&&u.node,i==="mcp"&&u.mcp]})}),e.jsx("div",{className:"border-t border-slate-800 px-4 py-2 text-xs text-slate-400",children:i==="mcp"?e.jsx("span",{children:" Add this to your MCP client configuration file (e.g., ~/.config/Claude/claude_desktop_config.json)"}):e.jsxs("span",{children:[""," ",e.jsx("a",{href:"https://docs.airweave.ai/api-reference/collections/search-advanced-collections-readable-id-search-post",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"Explore the full API documentation"})]})})]})]})})}function $e({title:t,count:r,children:s,defaultExpanded:a=!1,showCopyButton:n=!1,copyText:i}){const[l,o]=c.useState(a),[d,u]=c.useState(!1),m=async h=>{if(h.stopPropagation(),!!i)try{await navigator.clipboard.writeText(i),u(!0),setTimeout(()=>u(!1),2e3)}catch(p){console.error("Failed to copy:",p)}};return e.jsxs("div",{className:"border-t",children:[e.jsxs("button",{onClick:()=>o(!l),className:"text-muted-foreground hover:text-foreground hover:bg-muted/50 flex w-full items-center gap-2 px-4 py-2 text-[10px] font-semibold tracking-wider uppercase transition-all duration-200",children:[l?e.jsx(_e,{className:"size-3"}):e.jsx(Ve,{className:"size-3"}),t,r!==void 0&&` (${r})`]}),l&&e.jsxs("div",{className:"relative px-4 pb-3",children:[n&&i&&e.jsx("button",{onClick:m,className:"text-muted-foreground hover:text-foreground hover:bg-muted absolute top-0 right-4 z-10 rounded-lg p-1.5 transition-all duration-200",title:"Copy content",children:d?e.jsx(te,{className:"size-3.5"}):e.jsx(ae,{className:"size-3.5"})}),s]})]})}function ur(t){return t===void 0?null:t>=0&&t<=1?{value:`${(t*100).toFixed(1)}%`,color:t>=.7?"green":t>=.5?"yellow":"gray"}:{value:t.toFixed(3),color:t>=10?"green":t>=5?"yellow":"gray"}}function xr({index:t,score:r}){const s=ur(r);if(!s)return null;const a=r!==void 0&&r>=0&&r<=1;return e.jsx(X,{delayDuration:200,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsxs("div",{className:k("flex flex-shrink-0 cursor-help items-center gap-2 rounded-full px-3 py-1 text-[11px] font-semibold whitespace-nowrap shadow-sm transition-all duration-200 hover:shadow-md",s.color==="green"&&"border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 dark:border-emerald-500/30 dark:bg-emerald-500/15 dark:text-emerald-400 dark:hover:bg-emerald-500/20",s.color==="yellow"&&"border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-100 dark:border-amber-500/30 dark:bg-amber-500/15 dark:text-amber-400 dark:hover:bg-amber-500/20",s.color==="gray"&&"hover:bg-gray-150 border-gray-300 bg-gray-100 text-gray-600 dark:border-gray-600/50 dark:bg-gray-700/40 dark:text-gray-400 dark:hover:bg-gray-700/50"),children:[e.jsxs("span",{className:"font-bold tracking-wider opacity-70",children:["#",t+1]}),e.jsx("div",{className:"h-3 w-px opacity-30 dark:bg-gray-400"}),e.jsx("span",{className:"font-mono tracking-tight",children:s.value})]})}),e.jsx(G,{side:"left",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-[11px] font-bold tracking-wide",children:["Result #",t+1]}),e.jsxs("div",{className:"text-[12px]",children:[e.jsx("span",{className:"font-medium",children:"Similarity:"})," ",e.jsx("span",{className:"font-semibold",children:a?`${(r*100).toFixed(1)}%`:r.toFixed(3)})]}),e.jsx("div",{className:"bg-border h-px w-full"}),e.jsx("div",{className:"text-muted-foreground text-[11px] leading-relaxed",children:"Position determined by semantic reranking."})]})})]})})}const mr=(t,r)=>t.index===r.index&&t.result.id===r.result.id&&t.result.score===r.result.score;function hr(t){try{const r=new Date(t);if(isNaN(r.getTime()))return t;const a=new Date().getTime()-r.getTime(),n=Math.floor(a/(1e3*60*60*24)),i=r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return n===0?`Today at ${i}`:n===1?`Yesterday at ${i}`:n<7?`${n} days ago`:r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})+" at "+i}catch{return t}}function pr(t,r){let s=t.replace(/Entity$/,"");if(s&&r){const a=r.replace(/[\s_-]/g,"");if(a){const n=new RegExp(`^${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}`,"i"),i=s.replace(/[\s_-]/g,"");n.test(i)&&(s=s.slice(a.length))}}return s&&s.replace(/([A-Z])/g," $1").trim()||"Document"}const fr=({result:t,index:r})=>{const s=t.payload||t,a=t.score,n=s.airweave_system_metadata,i=s.entity_id||s.id||s._id,l=n?.source_name||s.source_name||"Unknown Source",o=le(l),d=s.textual_representation||"",u=s.breadcrumbs||[],m=s.web_url,h=s.url,p=m||h,x=!!(h&&m&&h!==m),g=s.name||"Untitled",j=n?.entity_type||"",v=pr(j,l),_=u.length>0?u.map(f=>typeof f=="string"?f:f.name||"").filter(Boolean).join(" > "):"",C=s.updated_at||s.created_at,A=l.split("_").map(f=>f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()).join(" "),E=c.useMemo(()=>{const f={},b=["entity_id","id","_id","textual_representation","name","breadcrumbs","url","web_url","airweave_system_metadata","source_name","created_at","updated_at","vector","vectors"];return Object.entries(s).forEach(([z,D])=>{if(!b.includes(z)&&D!==null&&D!==void 0&&D!==""){const S=z.split("_").map(N=>N.charAt(0).toUpperCase()+N.slice(1)).join(" ");f[S]=D}}),f},[s]),T=Object.keys(E).length>0;return e.jsxs("div",{"data-entity-id":i,className:"group bg-card relative overflow-hidden rounded-xl border transition-all duration-300",children:[e.jsx("div",{className:"border-b px-4 py-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"bg-muted flex size-8 flex-shrink-0 items-center justify-center overflow-hidden rounded-lg",title:A,children:e.jsx("img",{src:o,alt:A,className:"size-full object-contain p-1.5",onError:f=>{f.currentTarget.style.display="none"}})}),e.jsxs("div",{className:"min-w-0 flex-1 pt-0.5",children:[e.jsxs("div",{className:"mb-1.5 flex flex-wrap items-center gap-2",children:[e.jsx("h3",{className:"text-foreground text-[14px] leading-snug font-semibold tracking-tight break-words",children:g}),p&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("a",{href:p,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 text-[12px] font-medium text-blue-600 transition-all duration-200 hover:gap-2 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(ke,{className:"size-3"}),"Open in ",A]}),x&&e.jsxs("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-[11px] font-medium text-blue-600 transition-all duration-200 hover:gap-1.5 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(Pt,{className:"size-3"}),"Download original"]})]})]}),e.jsxs("div",{className:"mb-0 flex flex-wrap items-center gap-1",children:[e.jsx("span",{className:"text-foreground bg-muted inline-flex items-center gap-1 rounded-md border px-2 py-0.5 text-[11px] font-medium",children:v}),_&&_.length>0&&e.jsx("span",{className:"text-muted-foreground bg-muted/50 inline-flex items-center gap-1 rounded-md border px-2 py-0.5 text-[11px] font-medium",children:_}),C&&e.jsx(X,{delayDuration:200,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsxs("span",{className:"text-muted-foreground bg-muted/30 inline-flex cursor-help items-center gap-1 rounded-md border px-2 py-0.5 text-[11px] font-medium",children:[e.jsx(st,{className:"size-3",strokeWidth:1.5}),hr(C)]})}),e.jsx(G,{side:"top",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-[11px] font-bold tracking-wide",children:s.updated_at?"Last Updated":"Created"}),e.jsx("div",{className:"font-mono text-[12px]",children:new Date(C).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]})})]})})]})]})]})}),e.jsx(xr,{index:r,score:a})]})}),d&&e.jsx($e,{title:"Preview",showCopyButton:!0,copyText:d,children:e.jsx("div",{className:"text-foreground max-h-[200px] overflow-hidden pr-8",children:e.jsx("p",{className:"text-[13px] leading-relaxed whitespace-pre-wrap",children:d.length>500?d.substring(0,500)+"...":d})})}),T&&e.jsx($e,{title:"Properties",count:Object.keys(E).length,children:e.jsx("div",{className:"bg-muted/30 -mx-4 px-4 pb-2.5",children:e.jsx("div",{className:"grid grid-cols-2 gap-x-6 gap-y-2.5",children:Object.entries(E).slice(0,8).map(([f,b])=>e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("span",{className:"text-muted-foreground min-w-[80px] pt-0.5 text-[10px] font-semibold tracking-wider uppercase",children:f}),e.jsx("span",{className:"text-muted-foreground flex-1 text-[12px] leading-snug break-words",children:typeof b=="object"?JSON.stringify(b):String(b).length>100?String(b).substring(0,100)+"...":String(b)})]})},f))})})})]})},gr=St.memo(fr,mr),ve=`{
  "must": [
    {
      "key": "source_name",
      "match": {
        "value": "slack"
      }
    }
  ]
}`;function yr({value:t,onChange:r,height:s="160px",className:a}){const{getAccessTokenSilently:n}=xe(),{organization:i}=oe(),[l,o]=c.useState(t||ve),[d,u]=c.useState(null),[m,h]=c.useState(!1),[p,x]=c.useState(null),[g,j]=c.useState(!1),v=c.useRef(null),_=c.useRef(null),C=c.useRef(!1);c.useEffect(()=>{C.current||(C.current=!0,!t&&l===ve&&r(ve,!0))},[t,l,r]),c.useEffect(()=>(i&&(async()=>{try{const b=await n(),z=await fetch(`${Z}/collections/internal/filter-schema`,{headers:ee(b,i?.id||"")});if(z.ok){const D=await z.json();D&&typeof D=="object"&&x(D)}}catch(b){console.error("Error fetching filter schema:",b)}})(),()=>{v.current&&clearTimeout(v.current),_.current&&clearTimeout(_.current)}),[n,i]);const A=c.useCallback(f=>{if(!f.trim())return{isValid:!0,error:null};let b;try{b=JSON.parse(f)}catch{return{isValid:!1,error:"Invalid JSON syntax"}}if(!p)return{isValid:!0,error:null};if(typeof b!="object"||b===null)return{isValid:!1,error:"Filter must be an object"};const z=["must","should","must_not","min_should"],D=Object.keys(b);return D.length===0?{isValid:!0,error:null}:!D.some(N=>z.includes(N))&&D.length>0?{isValid:!1,error:`Filter should have one of: ${z.join(", ")}`}:{isValid:!0,error:null}},[p]);c.useEffect(()=>{if(l&&p){const f=A(l);u(f.error)}},[p,A,l]);const E=c.useCallback(f=>{if(o(f),!f.trim()){u(null),h(!1),r("",!0);return}h(!0),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{const b=A(f);u(b.error),h(!1),r(f,b.isValid)},500)},[A,r]),T=c.useCallback(()=>{const f=l.trim();f&&(navigator.clipboard.writeText(f),j(!0),_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{j(!1)},2e3))},[l]);return e.jsxs("div",{className:k("space-y-2",a),children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:l,onChange:f=>E(f.target.value),className:k("w-full resize-none rounded-md border p-3 pr-20 font-mono text-xs transition-colors","bg-slate-900 text-slate-100 placeholder:text-slate-600",d?"border-red-500 focus:border-red-500":"border-slate-700 focus:border-blue-500","focus:ring-1 focus:outline-none",d?"focus:ring-red-500":"focus:ring-blue-500"),style:{height:s},spellCheck:!1}),e.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:T,className:"rounded p-1 text-slate-400 transition-colors hover:bg-slate-700 hover:text-slate-200",title:"Copy filter",children:g?e.jsx(te,{className:"size-3.5 text-green-500"}):e.jsx(ae,{className:"size-3.5"})}),m?e.jsx("div",{className:"text-xs text-slate-400",children:"Validating..."}):d?e.jsx(ye,{className:"size-4 text-red-500"}):l.trim()?e.jsx(_t,{className:"size-4 text-green-500"}):null]})]}),d&&e.jsxs("div",{className:"flex items-start gap-1 text-xs text-red-500",children:[e.jsx(ye,{className:"mt-0.5 size-3 shrink-0"}),e.jsx("span",{children:d})]})]})}function br({onDragStart:t,onDrag:r,onDragEnd:s,computeValue:a}){const[n,i]=c.useState(!1),[l,o]=c.useState(null),d=c.useCallback(u=>{u.preventDefault(),i(!0);const m=a(u);o(m),t?.(u),r(u.nativeEvent,m)},[a,r,t]);return c.useEffect(()=>{if(!n)return;const u=h=>{const p=a(h);o(p),r(h,p)},m=()=>{i(!1),o(null),s?.()};return document.addEventListener("mousemove",u),document.addEventListener("mouseup",m),()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",m)}},[n,a,r,s]),{isDragging:n,onMouseDown:d,currentValue:l}}function jr(t){const[r,s]=c.useState(t);return c.useEffect(()=>{s(t)},[t]),[r,s]}function Nr({value:t,onChange:r,className:s}){const[a,n]=jr(t),i=c.useRef(null),l=h=>Math.max(0,Math.min(100,h*100)),o=c.useCallback(h=>{if(!i.current)return 0;const p=i.current.getBoundingClientRect(),x=(h.clientX-p.left)/p.width,g=Math.max(0,Math.min(1,x));return Math.round(g*10)/10},[]),{isDragging:d,onMouseDown:u}=br({computeValue:o,onDrag:(h,p)=>{n(p),r(p)}}),m=l(a);return e.jsxs("div",{className:k("space-y-1.5",s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-white/60",children:"0"}),e.jsx("div",{className:"text-xs font-semibold text-white",children:a.toFixed(1)}),e.jsx("span",{className:"text-[10px] text-white/60",children:"1"})]}),e.jsxs("div",{ref:i,className:"relative h-1.5 cursor-pointer rounded-full bg-gray-700",onMouseDown:u,children:[e.jsx("div",{className:k("absolute top-0 left-0 h-full rounded-full",a>0?"bg-primary":"bg-gray-600"),style:{width:`${m}%`,transition:d?"none":"width 0.1s ease-out"}}),e.jsx("div",{className:k("absolute top-1/2 size-4 -translate-y-1/2 cursor-grab rounded-full shadow-md",d&&"cursor-grabbing",a>0?"bg-primary border border-white":"border border-gray-400 bg-white"),style:{left:`${m}%`,transform:"translateX(-50%) translateY(-50%)",transition:d?"none":"left 0.1s ease-out, background-color 0.2s"},onMouseDown:u})]})]})}class Re extends Error{constructor(r){super(r),this.name="HandledStreamError"}}function vr(){const t=c.useRef(null),r=c.useRef(0),s=c.useCallback(()=>{t.current&&(t.current.abort(),t.current=null)},[]);return{executeSearch:c.useCallback(async({collectionId:n,requestBody:i,token:l,orgId:o,onStreamEvent:d,onSuccess:u,onError:m})=>{s();const h=++r.current,p=new AbortController;t.current=p;const x=performance.now();try{const g=await fetch(`${Z}/collections/${n}/search/stream`,{method:"POST",headers:ee(l,o),body:JSON.stringify(i),signal:p.signal});if(!g.ok||!g.body){const E=await g.text().catch(()=>"");throw new Error(E||`Stream failed: ${g.status} ${g.statusText}`)}const j=g.body.getReader(),v=new TextDecoder;let _="",C=[],A=null;for(;;){const{value:E,done:T}=await j.read();if(T||r.current!==h)break;_+=v.decode(E,{stream:!0});const f=_.split(`

`);_=f.pop()||"";for(const b of f){const z=b.split(`
`).filter(N=>N.startsWith("data:")).map(N=>N.slice(5).trim());if(z.length===0)continue;const D=z.join(`
`);let S;try{S=JSON.parse(D)}catch{continue}switch(d?.(S),S.type){case"results":Array.isArray(S.results)&&(C=S.results);break;case"completion_done":typeof S.text=="string"&&(A=S.text);break;case"error":{const N=performance.now(),w=Math.round(N-x),y=S,q=y.message||"Streaming error",Q=y.transient===!0;throw m(new Error(q),w,Q),new Re(q)}case"done":{const N=performance.now(),w=Math.round(N-x);u({completion:A,results:C,responseTime:w},w);break}}}}}catch(g){const j=g;if(j.name!=="AbortError"){if(!(j instanceof Re)){const v=performance.now(),_=Math.round(v-x);m(j,_,!0)}}}finally{r.current===h&&t.current===p&&(t.current=null)}},[s]),cancelSearch:s,isActive:()=>t.current!==null}}const qe=100;function wr(){const[t,r]=c.useState(null),[s,a]=c.useState(null),n=c.useRef(null);c.useEffect(()=>()=>{n.current&&clearTimeout(n.current)},[]);const i=c.useCallback(m=>{n.current&&(clearTimeout(n.current),n.current=null),r(m)},[]),l=c.useCallback(m=>{s!==m&&(n.current=setTimeout(()=>{r(h=>h===m?null:h)},qe))},[s]),o=c.useCallback(m=>{n.current&&(clearTimeout(n.current),n.current=null),a(m),r(m)},[]),d=c.useCallback(m=>{a(null),n.current=setTimeout(()=>{r(h=>h===m?null:h)},qe)},[]),u=c.useCallback(m=>{r(m)},[]);return{openTooltip:t,handleMouseEnter:i,handleMouseLeave:l,handleContentMouseEnter:o,handleContentMouseLeave:d,forceOpen:u}}function kr({onClick:t}){return e.jsx(X,{delayDuration:0,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsx("button",{type:"button",onClick:t,className:"absolute top-2 right-2 z-20 flex size-8 items-center justify-center rounded-md border border-dashed border-blue-500/30 bg-blue-500/10 shadow-sm transition-all hover:border-blue-400/40 hover:bg-blue-500/15",title:"View integration code",children:e.jsx(zt,{className:"size-4 text-blue-400"})})}),e.jsxs(G,{side:"left",sideOffset:8,children:[e.jsx("p",{className:"font-semibold",children:"Call the Search API"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Open a ready-to-use snippet for JS or Python."})]})]})})}function Cr({value:t,onChange:r,onSubmit:s,isDisabled:a,isSearching:n,usageLimit:i}){const l=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),!a&&!n&&t.trim()&&s())};return a&&i?i.reason==="no_sources"?e.jsx("textarea",{value:t,onChange:o=>r(o.target.value),onKeyDown:o=>{o.key==="Enter"&&!o.shiftKey&&o.preventDefault()},placeholder:"Connect a source to start searching",disabled:!0,className:"placeholder:text-muted-foreground h-20 w-full resize-none overflow-y-auto rounded-xl bg-transparent px-2 py-1.5 pr-28 text-sm leading-relaxed opacity-60 outline-none"}):e.jsx(X,{delayDuration:0,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsx("div",{children:e.jsx("textarea",{value:t,onChange:o=>r(o.target.value),onKeyDown:o=>{o.key==="Enter"&&!o.shiftKey&&o.preventDefault()},placeholder:"Ask a question about your data",disabled:!0,className:"placeholder:text-muted-foreground h-20 w-full resize-none overflow-y-auto rounded-xl bg-transparent px-2 py-1.5 pr-28 text-sm leading-relaxed opacity-60 outline-none"})})}),e.jsx(G,{className:"max-w-xs",children:e.jsx("p",{className:"text-sm",children:i.isChecking?"Checking usage...":i.reason==="usage_limit_exceeded"?e.jsxs(e.Fragment,{children:["Query limit reached."," ",e.jsx("a",{href:"/organization/settings?tab=billing",className:"underline",children:"Upgrade your plan"})," ","to continue searching."]}):i.reason==="payment_required"?e.jsxs(e.Fragment,{children:["Billing issue detected."," ",e.jsx("a",{href:"/organization/settings?tab=billing",className:"underline",children:"Update billing"})," ","to continue searching."]}):"Search is currently disabled."})})]})}):e.jsx("textarea",{value:t,onChange:o=>r(o.target.value),onKeyDown:l,placeholder:"Ask a question about your data",className:"placeholder:text-muted-foreground h-20 w-full resize-none overflow-y-auto rounded-xl bg-transparent px-2 py-1.5 pr-28 text-sm leading-relaxed outline-none"})}const Sr=[{id:"hybrid",icon:e.jsx(ds,{className:"size-4",strokeWidth:1.5}),title:"Hybrid Search",description:"Combines semantic and keyword signals"},{id:"neural",icon:e.jsx(Zt,{className:"size-4",strokeWidth:1.5}),title:"Neural Search",description:"Pure semantic matching using embeddings"},{id:"keyword",icon:e.jsx(Es,{className:"size-4",strokeWidth:1.5}),title:"Keyword Search",description:"BM25 keyword matching"}];function _r({value:t,onChange:r,openTooltip:s,onMouseEnter:a,onMouseLeave:n,onContentMouseEnter:i,onContentMouseLeave:l}){return e.jsx("div",{className:"inline-block h-7",children:e.jsx("div",{className:"bg-background relative grid h-full grid-cols-3 items-stretch gap-0.5 overflow-hidden rounded-md border p-0.5",children:Sr.map(o=>e.jsxs(K,{open:s===o.id,children:[e.jsx(J,{asChild:!0,children:e.jsx("button",{type:"button",onClick:()=>r(o.id),onMouseEnter:()=>a(o.id),onMouseLeave:()=>n(o.id),className:k("flex aspect-square h-full items-center justify-center rounded-md border transition-all",t===o.id?"border-primary text-primary":"text-foreground hover:bg-muted border-transparent"),children:o.icon})}),e.jsxs(G,{side:"bottom",onMouseEnter:()=>i(o.id),onMouseLeave:()=>l(o.id),children:[e.jsx("p",{className:"font-semibold",children:o.title}),e.jsx("p",{className:"text-muted-foreground text-xs",children:o.description}),e.jsx("div",{className:"border-border mt-2 border-t pt-2",children:e.jsx("a",{href:"https://docs.airweave.ai/search#search-method",target:"_blank",rel:"noreferrer",className:"text-xs text-blue-400 hover:underline",children:"Docs"})})]})]},o.id))})})}function zr({isSearching:t,hasQuery:r,queriesAllowed:s,isCheckingUsage:a,canRetry:n,retryMessage:i,onSubmit:l,onCancel:o,onRetry:d}){const u=()=>{t?o():n?d():l()},m=()=>t?"Stop search":n?i||"Connection interrupted. Click to retry.":r?s?a?"Checking usage...":"Send query":"Query limit reached":"Type a question to enable",h=()=>t?e.jsx(nt,{className:"size-4 text-red-500"}):n?e.jsx(ze,{className:"text-muted-foreground size-4"}):e.jsx(Yt,{className:"size-4"});return e.jsx(X,{delayDuration:0,children:e.jsxs(K,{children:[e.jsx(J,{asChild:!0,children:e.jsx(R,{variant:"outline",size:"icon",className:"size-8",onClick:u,disabled:t?!1:!r||!s||a,children:h()})}),e.jsx(G,{children:m()})]})})}function ge({id:t,icon:r,isActive:s,onClick:a,tooltip:n,openTooltip:i,onMouseEnter:l,onMouseLeave:o,onContentMouseEnter:d,onContentMouseLeave:u}){return e.jsxs(K,{open:i===t,children:[e.jsx(J,{asChild:!0,children:e.jsx("div",{onMouseEnter:()=>l(t),onMouseLeave:()=>o(t),className:k("h-7 w-8 overflow-hidden rounded-md border p-0",s?"border-primary":"border-border/50"),children:e.jsx("button",{type:"button",onClick:a,className:k("flex size-full items-center justify-center rounded-md transition-all",s?"text-primary hover:bg-primary/10":"text-foreground hover:bg-muted"),children:r})})}),e.jsxs(G,{side:"bottom",onMouseEnter:()=>d(t),onMouseLeave:()=>u(t),children:[e.jsx("p",{className:"font-semibold",children:n.title}),e.jsx("p",{className:"text-muted-foreground text-xs",children:n.description}),n.docsUrl&&e.jsx("div",{className:"border-border mt-2 border-t pt-2",children:e.jsx("a",{href:n.docsUrl,target:"_blank",rel:"noreferrer",className:"text-xs text-blue-400 hover:underline",children:"Docs"})})]})]})}function Er({toggles:t,onToggle:r,filterJson:s,onFilterChange:a,recencyBiasValue:n,onRecencyBiasChange:i,openTooltip:l,onMouseEnter:o,onMouseLeave:d,onContentMouseEnter:u,onContentMouseLeave:m}){return e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ge,{id:"queryExpansion",icon:e.jsx(Wt,{className:"size-4",strokeWidth:1.5}),isActive:t.queryExpansion,onClick:()=>r("queryExpansion"),tooltip:{title:"Query Expansion",description:"Generates similar versions of your query",docsUrl:"https://docs.airweave.ai/search#query-expansion"},openTooltip:l,onMouseEnter:o,onMouseLeave:d,onContentMouseEnter:u,onContentMouseLeave:m}),e.jsxs(K,{open:l==="filter",children:[e.jsx(J,{asChild:!0,children:e.jsx("div",{onMouseEnter:()=>o("filter"),onMouseLeave:()=>d("filter"),className:k("h-7 w-8 overflow-hidden rounded-md border p-0",t.filter?"border-primary":"border-border/50"),children:e.jsx("button",{type:"button",onClick:()=>r("filter"),className:k("flex size-full items-center justify-center rounded-md transition-all",t.filter?"text-primary hover:bg-primary/10":"text-foreground hover:bg-muted"),children:e.jsx(Ss,{className:"size-4",strokeWidth:1.5})})})}),e.jsx(G,{side:"bottom",className:"w-[360px] max-w-[90vw]",onMouseEnter:()=>u("filter"),onMouseLeave:()=>m("filter"),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Metadata Filtering"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:"Filter by fields like source, status, or date before searching."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-400",children:"JSON:"}),e.jsx(yr,{value:s,onChange:a,height:"160px"})]}),e.jsx("div",{className:"border-border border-t pt-2",children:e.jsx("a",{href:"https://docs.airweave.ai/search#filtering-results",target:"_blank",rel:"noreferrer",className:"text-xs text-blue-400 hover:underline",children:"Docs"})})]})})]}),e.jsx(ge,{id:"queryInterpretation",icon:e.jsx(os,{className:"size-4",strokeWidth:1.5}),isActive:t.queryInterpretation,onClick:()=>r("queryInterpretation"),tooltip:{title:"Query Interpretation (Beta)",description:"Auto-extracts filters from natural language",docsUrl:"https://docs.airweave.ai/search#query-interpretation-beta"},openTooltip:l,onMouseEnter:o,onMouseLeave:d,onContentMouseEnter:u,onContentMouseLeave:m}),e.jsxs(K,{open:l==="recencyBias",children:[e.jsx(J,{asChild:!0,children:e.jsx("div",{onMouseEnter:()=>o("recencyBias"),onMouseLeave:()=>d("recencyBias"),className:k("h-7 w-8 overflow-hidden rounded-md border p-0",t.recencyBias?"border-primary":"border-border/50"),children:e.jsx("button",{type:"button",onClick:()=>r("recencyBias"),className:k("flex size-full items-center justify-center rounded-md transition-all",t.recencyBias?"text-primary hover:bg-primary/10":"text-foreground hover:bg-muted"),children:e.jsx(as,{className:"size-4",strokeWidth:1.5})})})}),e.jsxs(G,{side:"bottom",className:"w-[240px]",onMouseEnter:()=>u("recencyBias"),onMouseLeave:()=>m("recencyBias"),children:[e.jsx("p",{className:"font-semibold",children:"Recency Bias"}),e.jsx("p",{className:"text-muted-foreground mb-2 text-xs",children:"Prioritize recent documents"}),e.jsx("div",{className:"px-1.5 py-1",children:e.jsx(Nr,{value:n,onChange:i})}),e.jsx("div",{className:"border-border mt-2 border-t pt-2",children:e.jsx("a",{href:"https://docs.airweave.ai/search#recency-bias",target:"_blank",rel:"noreferrer",className:"text-xs text-blue-400 hover:underline",children:"Docs"})})]})]}),e.jsx(ge,{id:"reRanking",icon:e.jsx(hs,{className:"size-4",strokeWidth:1.5}),isActive:t.reRanking,onClick:()=>r("reRanking"),tooltip:{title:"AI Reranking",description:"LLM reorders results for better relevance",docsUrl:"https://docs.airweave.ai/search#ai-reranking"},openTooltip:l,onMouseEnter:o,onMouseLeave:d,onContentMouseEnter:u,onContentMouseLeave:m}),e.jsx(ge,{id:"answer",icon:e.jsx(Jt,{className:"size-4",strokeWidth:1.5}),isActive:t.answer,onClick:()=>r("answer"),tooltip:{title:"Generate Answer",description:"Returns an AI-written answer",docsUrl:"https://docs.airweave.ai/search#generate-ai-answers"},openTooltip:l,onMouseEnter:o,onMouseLeave:d,onContentMouseEnter:u,onContentMouseLeave:m})]})}const Tr={queryExpansion:!0,filter:!1,queryInterpretation:!1,recencyBias:!1,reRanking:!0,answer:!0};function Ar({collectionId:t,onSearch:r,onSearchStart:s,onSearchEnd:a,onStreamEvent:n,onCancel:i,className:l,disabled:o,disabledReason:d}){const{getAccessTokenSilently:u}=xe(),{organization:m}=oe(),{executeSearch:h,cancelSearch:p}=vr(),x=wr(),[g,j]=c.useState(""),[v,_]=c.useState("hybrid"),[C,A]=c.useState(!1),[E,T]=c.useState(""),[f,b]=c.useState(!0),[z,D]=c.useState(0),[S,N]=c.useState(Tr),[w,y]=c.useState(!1),[q,Q]=c.useState("YOUR_API_KEY"),[Y,$]=c.useState(!0),[O,I]=c.useState(null),[H,M]=c.useState(!0),[F,ce]=c.useState(null),be=g.trim().length>0,lt=!!F&&!C,Ee=!Y||H||!!o,de=c.useCallback(async()=>{if(m)try{M(!0);const U=await u(),L=await fetch(`${Z}/usage/check-action?action=queries`,{headers:ee(U,m.id)});if(L.ok){const V=await L.json();$(V.allowed),I(V)}else $(!0),I(null)}catch{$(!0),I(null)}finally{M(!1)}},[m,u]);c.useEffect(()=>{de()},[de]),c.useEffect(()=>{(async()=>{if(m)try{const L=await u(),V=await fetch(`${Z}/api-keys`,{headers:ee(L,m.id)});if(V.ok){const re=await V.json();Array.isArray(re)&&re.length>0&&re[0].decrypted_key&&Q(re[0].decrypted_key)}}catch(L){console.error("Error fetching API key:",L)}})()},[m,u]),Ht({key:"Escape",onKeyDown:()=>y(!1),enabled:w}),c.useEffect(()=>(w?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[w]);const ot=c.useCallback(()=>{p(),n?.({type:"cancelled"}),i?.(),de()},[p,n,i,de]),je=c.useCallback(async()=>{if(!be||!t||C||!m||!Y||H)return;ce(null);const U=S.answer?"completion":"raw";A(!0),s?.(U);try{const L=await u();let V=null;if(S.filter&&E&&f)try{V=JSON.parse(E)}catch{V=null}const re={query:g,retrieval_strategy:v,expand_query:S.queryExpansion,interpret_filters:S.queryInterpretation,temporal_relevance:S.recencyBias?z:0,rerank:S.reRanking,generate_answer:S.answer};V&&(re.filter=V),await h({collectionId:t,query:g,requestBody:re,token:L,orgId:m.id,onStreamEvent:n,onSuccess:(pe,fe)=>{r(pe,U,fe)},onError:(pe,fe,xt)=>{xt?(ce({message:pe.message}),r({results:[],error:"Something went wrong, please try again.",errorIsTransient:!0},U,fe)):r({results:[],error:pe.message,errorIsTransient:!1},U,fe)}})}catch{}finally{A(!1),a?.(),de()}},[be,t,g,v,S,E,f,z,C,m,Y,H,u,h,r,s,a,n,de]),ct=c.useCallback(U=>{N(U==="filter"?L=>{const V=!L.filter;return V&&x.forceOpen("filter"),{...L,filter:V}}:U==="recencyBias"?L=>{const V=!L.recencyBias;return V&&x.forceOpen("recencyBias"),{...L,recencyBias:V}}:L=>({...L,[U]:!L[U]}))},[x]),dt=c.useCallback(U=>{D(U),N(L=>({...L,recencyBias:U>0}))},[]),ut=c.useCallback((U,L)=>{T(U),b(L)},[]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:k("w-full",l),children:e.jsxs("div",{className:"bg-card overflow-hidden rounded-lg border",children:[e.jsxs("div",{className:"relative px-2 pt-2 pb-1",children:[e.jsx(kr,{onClick:()=>y(!0)}),e.jsx(Cr,{value:g,onChange:j,onSubmit:je,isDisabled:Ee,isSearching:C,usageLimit:Ee?{isChecking:H,isAllowed:Y&&!o,reason:o?d:O?.reason}:void 0})]}),e.jsx("div",{className:"flex items-center justify-between px-2 pb-2",children:e.jsxs(X,{delayDuration:0,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(_r,{value:v,onChange:_,openTooltip:x.openTooltip,onMouseEnter:x.handleMouseEnter,onMouseLeave:x.handleMouseLeave,onContentMouseEnter:x.handleContentMouseEnter,onContentMouseLeave:x.handleContentMouseLeave}),e.jsx(Er,{toggles:S,onToggle:ct,filterJson:E,onFilterChange:ut,recencyBiasValue:z,onRecencyBiasChange:dt,openTooltip:x.openTooltip,onMouseEnter:x.handleMouseEnter,onMouseLeave:x.handleMouseLeave,onContentMouseEnter:x.handleContentMouseEnter,onContentMouseLeave:x.handleContentMouseLeave})]}),e.jsx(zr,{isSearching:C,hasQuery:be,queriesAllowed:Y,isCheckingUsage:H,canRetry:lt,retryMessage:F?.message,onSubmit:je,onCancel:ot,onRetry:()=>{ce(null),je()}})]})})]})}),w&&t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black/60 backdrop-blur-sm",onClick:()=>y(!1)}),e.jsx("div",{className:"pointer-events-none fixed inset-0 z-50 flex items-center justify-center p-8",children:e.jsxs("div",{className:"pointer-events-auto relative w-full max-w-4xl",onClick:U=>U.stopPropagation(),children:[e.jsx("button",{onClick:()=>y(!1),className:"bg-muted hover:bg-muted/80 text-muted-foreground hover:text-foreground absolute top-2 right-2 z-10 flex size-8 items-center justify-center rounded-md transition-colors",title:"Close (Esc)",children:e.jsx(Pe,{className:"size-4"})}),e.jsx(dr,{collectionReadableId:t,query:g||"Ask a question about your data",searchConfig:{search_method:v,expansion_strategy:S.queryExpansion?"auto":"no_expansion",enable_query_interpretation:S.queryInterpretation,recency_bias:S.recencyBias?z:0,enable_reranking:S.reRanking,response_type:S.answer?"completion":"raw"},filter:S.filter?E:null,apiKey:q})]})})]})]})}function Le(t,r){const[s,a]=c.useState(()=>{if(typeof window>"u")return r;try{const i=localStorage.getItem(t);if(i===null)return r;if(typeof r=="boolean")return i==="true";if(typeof r=="number"){const l=parseFloat(i);return isNaN(l)?r:l}return typeof r=="string"?i:JSON.parse(i)}catch{return r}}),n=c.useCallback(i=>{a(l=>{const o=typeof i=="function"?i(l):i;try{typeof o=="object"?localStorage.setItem(t,JSON.stringify(o)):localStorage.setItem(t,String(o))}catch{}return o})},[t]);return[s,n]}function Ie(t,r,s){const a=[],n=/(\[\[(\d+)\]\])|(`([^`]+)`)|(\*\*([^*]+)\*\*)|(\[([^\]]+)\]\(([^)]+)\))/g;let i=0,l,o=0;for(;(l=n.exec(t))!==null;){if(l.index>i&&a.push(t.substring(i,l.index)),l[1]){const d=parseInt(l[2],10);a.push(e.jsx("button",{onClick:()=>r(d-1),className:"mx-0.5 inline-flex size-5 items-center justify-center rounded bg-blue-500/20 text-xs font-medium text-blue-400 transition-colors hover:bg-blue-500/30",title:`Jump to source ${d}`,children:d},`cite-${s}-${o++}`))}else l[3]?a.push(e.jsx("code",{className:"rounded bg-slate-800 px-1.5 py-0.5 text-sm text-slate-200",children:l[4]},`code-${s}-${o++}`)):l[5]?a.push(e.jsx("strong",{children:l[6]},`bold-${s}-${o++}`)):l[7]&&a.push(e.jsx("a",{href:l[9],target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 underline hover:text-blue-300",children:l[8]},`link-${s}-${o++}`));i=l.index+l[0].length}return i<t.length&&a.push(t.substring(i)),a}function Fe(t,r,s){const a=[];return t.split(/\n\n+/).forEach((i,l)=>{if(!i.trim())return;const o=i.split(`
`),d=o.filter(u=>/^[-*\d.]\s/.test(u.trim()));if(d.length>0&&d.length===o.length){const u=o.map((m,h)=>{const p=m.replace(/^[-*\d.]\s+/,"");return e.jsx("li",{children:Ie(p,r,`${s}-${l}-${h}`)},`li-${s}-${l}-${h}`)});a.push(e.jsx("ul",{className:"my-2 ml-4 list-disc space-y-1",children:u},`ul-${s}-${l}`))}else a.push(e.jsx("p",{className:"my-2",children:Ie(i.replace(/\n/g," "),r,`${s}-${l}`)},`p-${s}-${l}`))}),a}function Dr(t,r){const s=[],a=/```(\w*)\n?([\s\S]*?)```/g;let n,i=0;for(;(n=a.exec(t))!==null;){if(n.index>i){const d=t.substring(i,n.index);s.push(...Fe(d,r,s.length))}const l=n[1]||"text",o=n[2];s.push(e.jsx("pre",{className:"my-3 overflow-x-auto rounded-lg bg-slate-900 p-4",children:e.jsx("code",{className:`language-${l} text-sm text-slate-200`,children:o.trim()})},`code-${s.length}`)),i=n.index+n[0].length}if(i<t.length){const l=t.substring(i);s.push(...Fe(l,r,s.length))}return s}function Mr(t){return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}function $r(t,r={}){const{enabled:s=!0}=r,a=c.useRef(null);return c.useEffect(()=>{!s||!a.current||(a.current.scrollTop=a.current.scrollHeight)},[s,...t]),a}const Rr={query_expansion_started:"Query Expansion",query_expansion_done:"Query Expansion",filter_interpretation_started:"Filter Interpretation",filter_interpretation_done:"Filter Interpretation",retrieval_started:"Retrieval",retrieval_done:"Retrieval",reranking_started:"Reranking",reranking_done:"Reranking",completion_started:"Generating Answer",completion_chunk:"Generating Answer",completion_done:"Answer Complete",results:"Results",done:"Complete",error:"Error"};function qr(t){const r=[],s=new Map;for(const a of t){const n=a.type;let i=n,l="completed";n.endsWith("_started")?(i=n.replace("_started",""),l="in_progress"):n.endsWith("_done")?(i=n.replace("_done",""),l="completed"):n==="completion_chunk"?(i="completion",l="in_progress"):n==="error"&&(l="error");const o=Rr[n]||n;let d=s.get(i);d||(d={id:i,label:o,events:[],status:"pending"},s.set(i,d),r.push(d)),d.events.push(a),d.status=l,d.label=o;const u=a;u.expanded_queries&&(d.output={expanded_queries:u.expanded_queries}),u.interpreted_filter&&(d.output={interpreted_filter:u.interpreted_filter}),u.results&&(d.output={result_count:u.results.length}),u.duration_ms&&(d.duration=u.duration_ms)}return r}function Lr({status:t}){switch(t){case"pending":return e.jsx("div",{className:"size-2 rounded-full bg-slate-500"});case"in_progress":return e.jsx(B,{className:"size-3 animate-spin text-blue-500"});case"completed":return e.jsx("div",{className:"flex size-4 items-center justify-center rounded-full bg-green-500/20",children:e.jsx(te,{className:"size-2.5 text-green-500"})});case"error":return e.jsx("div",{className:"size-2 rounded-full bg-red-500"});default:return null}}function Ir({group:t,isExpanded:r,onToggle:s}){const a=t.output,n=a&&Object.keys(a).length>0;return e.jsxs("div",{className:"border-b border-slate-800 last:border-b-0",children:[e.jsxs("button",{onClick:n?s:void 0,className:k("flex w-full items-center gap-3 px-4 py-2.5 text-left transition-colors",n&&"cursor-pointer hover:bg-slate-800/50"),disabled:!n,children:[e.jsx("div",{className:"w-4",children:n&&(r?e.jsx(_e,{className:"size-3.5 text-slate-400"}):e.jsx(Ve,{className:"size-3.5 text-slate-400"}))}),e.jsx(Lr,{status:t.status}),e.jsx("span",{className:k("flex-1 text-sm",t.status==="error"?"text-red-400":"text-slate-200"),children:t.label}),t.duration!==void 0&&e.jsxs("span",{className:"text-xs text-slate-500",children:[t.duration,"ms"]})]}),r&&n&&e.jsx("div",{className:"border-t border-slate-800 bg-slate-950 px-4 py-3",children:e.jsx("pre",{className:"overflow-x-auto text-xs text-slate-400",children:JSON.stringify(a,null,2)})})]})}function Fr({events:t,isSearching:r=!1,className:s}){const[a,n]=c.useState(new Set),[i,l]=c.useState(!1),o=$r([t],{enabled:r}),d=c.useMemo(()=>qr(t),[t]),u=c.useCallback(h=>{n(p=>{const x=new Set(p);return x.has(h)?x.delete(h):x.add(h),x})},[]),m=c.useCallback(async()=>{const h={timestamp:new Date().toISOString(),events:t};await navigator.clipboard.writeText(JSON.stringify(h,null,2)),l(!0),setTimeout(()=>l(!1),2e3)},[t]);return t.length===0&&!r?null:e.jsxs("div",{className:k("overflow-hidden",s),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-800 bg-slate-900 px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-200",children:"Search Trace"}),r&&e.jsx(B,{className:"size-3 animate-spin text-blue-500"})]}),e.jsx(R,{variant:"ghost",size:"sm",onClick:m,className:"size-7 p-0 text-slate-400 hover:text-slate-200",title:"Copy trace",children:i?e.jsx(te,{className:"size-3.5 text-green-500"}):e.jsx(ae,{className:"size-3.5"})})]}),e.jsxs("div",{ref:o,className:"max-h-[400px] overflow-y-auto bg-slate-900/50",children:[d.map(h=>e.jsx(Ir,{group:h,isExpanded:a.has(h.id),onToggle:()=>u(h.id)},h.id)),r&&t.length===0&&e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3",children:[e.jsx(B,{className:"size-4 animate-spin text-blue-500"}),e.jsx("span",{className:"text-sm text-slate-400",children:"Starting search..."})]})]})]})}const Oe={EXPANDED:"searchResponse-expanded",ACTIVE_TAB:"searchResponse-activeTab"};function Or({searchResponse:t,isSearching:r,responseType:s="raw",events:a=[],className:n}){const[i,l]=c.useState(!1),[o,d]=c.useState(!1),u=s==="completion"?"answer":"entities",[m,h]=Le(Oe.ACTIVE_TAB,u),[p,x]=Le(Oe.EXPANDED,!0),g=25,j=25,[v,_]=c.useState(g),C=500,[A,E]=c.useState(!1),T=c.useRef(new Map),f=t?.completion||"",b=c.useMemo(()=>t?.results||[],[t?.results]),z=t?.responseTime,D=!!t?.error,N=!!t?.errorIsTransient?"Something went wrong, please try again.":t?.error,w=c.useCallback(M=>{const F=T.current.get(M);F&&(F.scrollIntoView({behavior:"smooth",block:"center"}),F.classList.add("ring-2","ring-blue-500"),setTimeout(()=>{F.classList.remove("ring-2","ring-blue-500")},1500)),h("entities")},[h]),y=c.useCallback(async()=>{f&&(await navigator.clipboard.writeText(f),l(!0),setTimeout(()=>l(!1),2e3))},[f]),q=c.useCallback(async()=>{t&&(await navigator.clipboard.writeText(JSON.stringify(t,null,2)),d(!0),setTimeout(()=>d(!1),2e3))},[t]),Q=c.useMemo(()=>{if(!t)return"";const M=JSON.stringify(t,null,2),F=M.split(`
`);return!A&&F.length>C?F.slice(0,C).join(`
`)+`
// ...`:M},[t,A]),Y=c.useMemo(()=>t?JSON.stringify(t,null,2).split(`
`).length:0,[t]),$=c.useMemo(()=>b.slice(0,v),[b,v]),O=b.length>v,I=a.length>0,H=c.useMemo(()=>f?Dr(f,w):null,[f,w]);return!t&&!r?null:r&&!t?e.jsx("div",{className:k("bg-card mt-4 rounded-lg border p-6",n),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(B,{className:"size-4 animate-spin"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"Searching..."})]})}):D?e.jsx("div",{className:k("border-destructive/50 bg-destructive/10 mt-4 rounded-lg border p-6",n),children:e.jsx("p",{className:"text-destructive text-sm",children:N})}):b.length===0&&!f?e.jsx(Se,{icon:e.jsx(ws,{}),title:"No results found",description:"Try adjusting your search query",className:k("bg-card mt-4 rounded-lg border",n)}):e.jsxs("div",{className:k("mt-4 space-y-4",n),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[I&&e.jsx(R,{variant:m==="trace"?"default":"outline",size:"sm",onClick:()=>h("trace"),children:"Trace"}),f&&e.jsx(R,{variant:m==="answer"?"default":"outline",size:"sm",onClick:()=>h("answer"),children:"Answer"}),e.jsxs(R,{variant:m==="entities"?"default":"outline",size:"sm",onClick:()=>h("entities"),children:["Results (",b.length,")"]}),e.jsx(R,{variant:m==="raw"?"default":"outline",size:"sm",onClick:()=>h("raw"),children:"Raw"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[z&&e.jsx("span",{className:"text-muted-foreground text-xs",children:Mr(z)}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>x(!p),className:"size-8 p-0",children:p?e.jsx(ts,{className:"size-4"}):e.jsx(_e,{className:"size-4"})})]})]}),p&&e.jsxs(e.Fragment,{children:[m==="trace"&&I&&e.jsx(Fr,{events:a,isSearching:r,className:"bg-card rounded-lg border"}),m==="answer"&&f&&e.jsxs("div",{className:"bg-card rounded-lg border p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"AI-Generated Answer"}),e.jsx(R,{variant:"ghost",size:"sm",onClick:y,className:"size-8 p-0",children:i?e.jsx(te,{className:"size-4 text-green-500"}):e.jsx(ae,{className:"size-4"})})]}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-sm leading-relaxed",children:H})]}),m==="entities"&&b.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-sm font-semibold",children:[b.length," Result",b.length!==1?"s":""]})}),e.jsx("div",{className:"space-y-3",children:$.map((M,F)=>e.jsx("div",{ref:ce=>{ce&&T.current.set(F,ce)},"data-entity-index":F,className:"transition-all duration-200",children:e.jsx(gr,{result:M,index:F})},M.id||M.entity_id||F))}),O&&e.jsx("div",{className:"flex justify-center pt-2",children:e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>_(M=>M+j),children:["Load"," ",Math.min(j,b.length-v)," ","More"]})})]}),m==="raw"&&t&&e.jsxs("div",{className:"bg-card rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-2",children:[e.jsxs("span",{className:"text-muted-foreground text-xs",children:[Y," lines"]}),e.jsx(R,{variant:"ghost",size:"sm",onClick:q,className:"size-8 p-0",children:o?e.jsx(te,{className:"size-4 text-green-500"}):e.jsx(ae,{className:"size-4"})})]}),e.jsx("div",{className:"max-h-[500px] overflow-auto bg-slate-900 p-4",children:e.jsx("pre",{className:"text-xs text-slate-300",children:e.jsx("code",{children:Q})})}),Y>C&&!A&&e.jsx("div",{className:"border-t px-4 py-2",children:e.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>E(!0),className:"text-xs",children:["Show all ",Y," lines"]})})]})]}),r&&e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2",children:[e.jsx(B,{className:"size-4 animate-spin"}),e.jsx("span",{className:"text-muted-foreground text-xs",children:"Updating results..."})]})]})}function Ur({collectionReadableId:t,className:r,disabled:s,disabledReason:a}){const[n,i]=c.useState(null),[l,o]=c.useState("raw"),[d,u]=c.useState(!1),[m,h]=c.useState(!1),[p,x]=c.useState([]),[g,j]=c.useState([]),v=c.useCallback((T,f,b)=>{i(T),o(f)},[]),_=c.useCallback(T=>{d||u(!0),h(!0),i(null),o(T),x([]),j([])},[d]),C=c.useCallback(()=>{h(!1)},[]),A=c.useCallback(T=>{j(f=>[...f,T]),T.type==="results"&&x(T.results)},[]),E=c.useCallback(()=>{j(T=>[...T,{type:"cancelled"}])},[]);return e.jsxs("div",{className:k("w-full",r),children:[e.jsx("div",{children:e.jsx(Ar,{collectionId:t,onSearch:v,onSearchStart:_,onSearchEnd:C,onStreamEvent:A,onCancel:E,disabled:s,disabledReason:a})}),d&&e.jsx("div",{children:e.jsx(Or,{searchResponse:m?{results:p}:n,isSearching:m,responseType:l,events:g})})]})}function on(){const t=Be(),r=Et(),{getAccessTokenSilently:s}=xe(),{organization:a,getOrgSlug:n}=oe(),i=we(),o=Tt.useParams().collectionId;if(!a)throw new Error("Organization context is required but not available");const d=a.id,u=n(a),[m,h]=c.useState(!1),[p,x]=c.useState(!1),[g,j]=c.useState(null),v=c.useRef(!1),_=Ze(y=>y.open),{data:C,isLoading:A,error:E,refetch:T}=he({queryKey:ne.collections.detail(d,o),queryFn:async()=>{const y=await s();return Rt(y,d,o)}}),{data:f=[],error:b,refetch:z}=he({queryKey:ne.sourceConnections.list(d,o),queryFn:async()=>{const y=await s();return As(y,d,o)},enabled:!!C}),D=c.useMemo(()=>{if(!f.length)return null;if(g){const y=f.find(q=>q.id===g);if(y)return y}return f[0]},[f,g]);c.useEffect(()=>{f.length>0&&!g&&j(f[0].id)},[f,g]),c.useEffect(()=>{if(v.current||!C)return;const y=r.state;y?.addSource&&(v.current=!0,_(C.readable_id,C.name,y.addSource),x(!0),t({to:r.pathname,replace:!0}))},[C,r.state,r.pathname,t,_]);const S=me({mutationFn:async()=>{const y=await s();return $t(y,d,o)},onSuccess:()=>{W.success("Collection deleted successfully"),i.invalidateQueries({queryKey:ne.collections.all(d)}),t({to:`/${u}/collections`})},onError:y=>{W.error(y instanceof Error?y.message:"Failed to delete collection")}});At({title:C?.name||"Loading...",description:C?.readable_id||""}),Dt({docs:e.jsx(Ot,{}),code:e.jsx(Ft,{collectionId:o}),help:e.jsx(It,{})});const N=c.useCallback(()=>{T(),z()},[T,z]),w=c.useCallback(()=>{C&&(_(C.readable_id,C.name),x(!0))},[C,_]);return A?e.jsx("div",{className:"flex h-full items-center justify-center p-6",children:e.jsx(Mt,{})}):E||b?e.jsx("div",{className:"p-6",children:e.jsx(Ae,{error:E instanceof Error?E:b instanceof Error?b:"Failed to load collection"})}):C?e.jsxs("div",{className:"container mx-auto flex max-w-[1000px] flex-col items-center py-6",children:[e.jsx(Qs,{collection:C,sourceConnections:f,onReload:N,onDelete:()=>h(!0)}),e.jsx("div",{className:"mt-10 w-full",children:e.jsx(Ur,{collectionReadableId:C.readable_id,disabled:f.length===0,disabledReason:"no_sources"})}),e.jsx("div",{className:"mt-8 w-full",children:e.jsx(ir,{sourceConnections:f,selectedConnectionId:g,onSelectConnection:j,onAddSource:w})}),D&&e.jsx("div",{className:"mt-4 w-full",children:e.jsx(nr,{sourceConnection:D,onConnectionDeleted:()=>{j(null),z()},onConnectionUpdated:z},D.id)}),e.jsx(Ys,{open:m,onOpenChange:h,onConfirm:()=>S.mutate(),collectionReadableId:C.readable_id,isDeleting:S.isPending}),e.jsx(Gs,{open:p,onOpenChange:y=>{x(y),y||z()}})]}):e.jsx("div",{className:"p-6",children:e.jsx(Ae,{error:"Collection not found"})})}export{on as component};
