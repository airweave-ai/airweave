import{j as e,a as N,B as w,b as $,a4 as re,d as M,n as R,r as A,i as E,q as C,t as D,D as U,o as z,p as H,s as Q,v as G,L,an as ie,R as ee,aj as le,ak as oe,ao as ce}from"./main-BEToz-TC.js";import{E as de}from"./empty-state-DKSl-bi2.js";import{A as me,b as ue,c as he,d as xe,e as ge,i as Y,f as fe,g as pe,h as je,C as be,E as ve}from"./error-state-DJ8okmbQ.js";import{L as ye}from"./loading-state-DlUdFJYL.js";import{u as q}from"./use-is-dark-pSwRFwVX.js";import{f as Ne,D as we}from"./use-docs-content-ogu5VP42.js";import{u as se}from"./useForm-Cs18dAFp.js";import{u as W,A as V}from"./api-form-CPp1CwpP.js";import{I as T}from"./input-Dgezjod8.js";import{c as Ce,b as te,d as ke,e as ae,u as _e,f as Fe,a as Ae}from"./auth-providers-Bc9ymBaZ.js";import{E as De,T as ne,P as Se,L as B}from"./trash-DC_b27ub.js";import{u as Pe}from"./org-context-QNZ_DRQw.js";import"./tabs-DYoc-HWa.js";function Ee(){const a="abcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let s=0;s<6;s++)n+=a.charAt(Math.floor(Math.random()*a.length));return n}function Le(a){if(!a||a.trim()==="")return"";let n=a.toLowerCase().trim();return n=n.replace(/[^a-z0-9\s]/g,""),n=n.replace(/\s+/g,"-"),n=n.replace(/-+/g,"-"),n=n.replace(/^-|-$/g,""),n}function J(a,n){if(!a||a.trim()==="")return"";const s=Le(a);return s?`${s}-${n}`:""}function I(a,n){const s={klavis:"klavis.png",pipedream:"pipedream.jpeg"};return s[a]?`/src/components/icons/auth_providers/${s[a]}`:n==="dark"?`/src/components/icons/auth_providers/${a}-light.svg`:`/src/components/icons/auth_providers/${a}-dark.svg`}const X=a=>Ne(a,"datetime"),Z=[{id:"coming-soon-klavis",name:"Klavis",short_name:"klavis",isComingSoon:!0}];function Te({name:a,shortName:n,isConnected:s=!1,isComingSoon:r=!1,onClick:d}){const o=q(),c=()=>{r||d?.()},p=g=>{const m=["bg-blue-500","bg-green-500","bg-purple-500","bg-orange-500","bg-pink-500","bg-indigo-500","bg-red-500","bg-yellow-500"],x=g.split("").reduce((h,b)=>h+b.charCodeAt(0),0)%m.length;return m[x]};return e.jsx("div",{className:N("relative min-w-[150px] overflow-hidden rounded-lg border transition-all",r?"cursor-not-allowed opacity-60":"group cursor-pointer","border-border hover:border-muted-foreground/30 bg-card hover:bg-accent/50",r&&"hover:border-border hover:bg-card"),onClick:c,children:e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 flex-shrink-0 items-center justify-center overflow-hidden rounded-md sm:h-10 sm:w-10",children:e.jsx("img",{src:I(n,o?"dark":"light"),alt:`${n} icon`,className:"h-8 w-8 rounded object-contain sm:h-9 sm:w-9",onError:g=>{g.currentTarget.style.display="none";const m=g.currentTarget.parentElement;m&&(m.classList.add(p(n)),m.innerHTML=`<span class="text-white font-semibold text-xs sm:text-sm">${n.substring(0,2).toUpperCase()}</span>`)}})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"truncate text-sm font-medium",children:a}),r&&e.jsx("span",{className:"text-muted-foreground text-xs",children:"Coming soon"})]})]}),!r&&e.jsx(w,{size:"icon",variant:"ghost",className:N("h-7 w-7 flex-shrink-0 rounded-full sm:h-8 sm:w-8",s?"bg-green-100 text-green-600 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400 dark:hover:bg-green-800/30":"bg-muted text-primary hover:bg-primary/10 group-hover:bg-primary/20"),children:s?e.jsx($,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}):e.jsx(re,{className:"h-3.5 w-3.5 transition-transform group-hover:scale-110 sm:h-4 sm:w-4"})})]})})}const Ve={composio:{url:"https://platform.composio.dev/",label:"Get API Key from Composio"},pipedream:{url:"https://pipedream.com/settings/api",label:"Get Client ID & Secret from Pipedream"}};function qe({providerShortName:a,fields:n,values:s,onChange:r}){const d=q(),o=Ve[a];return!n||n.length===0?null:e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-muted-foreground text-xs font-medium tracking-wider uppercase",children:"Authentication"}),o&&e.jsxs(w,{type:"button",variant:"outline",size:"sm",className:"h-7 text-xs",onClick:()=>window.open(o.url,"_blank"),children:[e.jsx("img",{src:I(a,d?"dark":"light"),alt:a,className:"mr-1.5 h-3 w-3 object-contain"}),o.label,e.jsx(De,{className:"ml-1.5 h-3 w-3"})]})]}),n.map(c=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:[c.title||c.name,c.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),c.description&&e.jsx("p",{className:"text-muted-foreground text-xs",children:c.description}),e.jsx(T,{type:c.secret?"password":"text",value:s[c.name]||"",onChange:p=>r(c.name,p.target.value),placeholder:c.secret?"••••••••":`Enter ${c.title||c.name}`})]},c.name))]})}function Ie({providerShortName:a,providerName:n,status:s="pending"}){const r=q(),d={pending:"Waiting for connection...",connected:"Connected",error:"Connection failed"}[s];return e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:N("flex h-14 w-14 items-center justify-center rounded-xl p-2.5","ring-muted-foreground/20 shadow-lg ring-2","bg-card"),children:e.jsx("img",{src:r?"/airweave-logo-svg-white-darkbg.svg":"/airweave-logo-svg-lightbg-blacklogo.svg",alt:"Airweave",className:"h-full w-full object-contain"})}),e.jsx("span",{className:"text-muted-foreground text-sm",children:d}),e.jsx("div",{className:N("flex h-14 w-14 items-center justify-center rounded-xl p-2.5","ring-muted-foreground/20 shadow-lg ring-2","bg-card"),children:e.jsx("img",{src:I(a,r?"dark":"light"),alt:n,className:"h-full w-full object-contain"})})]})})}function Me({open:a,onOpenChange:n,authProvider:s,onSuccess:r,orgId:d}){const{getAccessTokenSilently:o}=M(),c=R(),p=A.useMemo(()=>Ee(),[a]),[g,m]=A.useState(!1),x=s?`My ${s.name} Connection`:"My Connection",{data:h,isLoading:b}=E({queryKey:C.authProviders.detail(d,s?.short_name??""),queryFn:async()=>{if(!s?.short_name)return null;const i=await o();return te(i,d,s.short_name)},enabled:a&&!!s?.short_name}),l=se({defaultValues:{name:x,readableId:J(x,p),authFields:{}},onSubmit:async({value:i})=>{t.mutate(i)}}),t=W({mutationFn:async i=>{const y=await o();return Ce(y,d,{name:i.name,readable_id:i.readableId,short_name:s?.short_name||"",auth_fields:i.authFields})},onSuccess:i=>{c.invalidateQueries({queryKey:C.authProviders.connections(d)}),D.success(`Successfully connected to ${s?.name}`,{description:"Your connection is now active and ready to use."}),n(!1),l.reset(),m(!1),r?.(i.readable_id)},onError:i=>{D.error("Connection Failed",{description:i.message})}}),j=i=>{l.setFieldValue("name",i),g||l.setFieldValue("readableId",J(i,p))},v=i=>{l.setFieldValue("readableId",i),m(!0)},k=(i,y)=>{const S=l.getFieldValue("authFields");l.setFieldValue("authFields",{...S,[i]:y})},f=()=>{const i=l.getFieldValue("name"),y=l.getFieldValue("authFields");if(!i||i.trim()==="")return!1;if(h?.auth_fields?.fields){for(const S of h.auth_fields.fields)if(!y[S.name]||y[S.name].trim()==="")return!1}return!0},_=i=>{i||(l.reset(),m(!1)),n(i)};return s?e.jsx(U,{open:a,onOpenChange:_,children:e.jsxs(z,{className:"flex max-h-[90vh] flex-col overflow-hidden sm:max-w-lg",children:[e.jsxs(H,{children:[e.jsxs(Q,{children:["Connect to ",s.name]}),e.jsxs(G,{children:["Create a connection to ",s.name," that can be used to authenticate to data sources"]})]}),b?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{className:"text-muted-foreground h-8 w-8 animate-spin"})}):e.jsx("form",{onSubmit:i=>{i.preventDefault(),l.handleSubmit()},className:"flex flex-1 flex-col overflow-hidden",children:e.jsxs(V,{method:"POST",endpoint:"https://api.airweave.ai/auth-providers/",className:"flex flex-1 flex-col overflow-hidden",body:{name:l.getFieldValue("name"),readable_id:l.getFieldValue("readableId"),short_name:s.short_name,auth_fields:l.getFieldValue("authFields")},onBodyChange:i=>{typeof i.name=="string"&&l.setFieldValue("name",i.name),typeof i.readable_id=="string"&&(l.setFieldValue("readableId",i.readable_id),m(!0)),i.auth_fields&&typeof i.auth_fields=="object"&&l.setFieldValue("authFields",i.auth_fields)},children:[e.jsx(V.Toggle,{}),e.jsxs(V.FormView,{className:"flex-1 space-y-6 overflow-y-auto",children:[e.jsx(Ie,{providerShortName:s.short_name,providerName:s.name,status:"pending"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-muted-foreground text-xs font-medium tracking-wider uppercase",children:"Name"}),e.jsx(l.Field,{name:"name",children:i=>e.jsx(T,{value:i.state.value,onChange:y=>j(y.target.value),placeholder:"My Connection"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-muted-foreground text-xs font-medium tracking-wider uppercase",children:"Readable ID"}),e.jsx(l.Field,{name:"readableId",children:i=>e.jsx(T,{value:i.state.value,onChange:y=>v(y.target.value),placeholder:"Auto-generated",className:"font-mono text-sm"})})]}),h?.auth_fields?.fields&&e.jsx(qe,{providerShortName:s.short_name,fields:h.auth_fields.fields,values:l.getFieldValue("authFields"),onChange:k})]}),e.jsx(V.CodeView,{editable:!0,className:"flex-1 overflow-y-auto"}),e.jsxs(V.Footer,{className:"border-t pt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>_(!1),disabled:t.isPending,children:"Cancel"}),e.jsx(w,{type:"submit",disabled:t.isPending||!f(),children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):"Connect"})]})]})})]})}):null}function Oe({open:a,onOpenChange:n,title:s,confirmValue:r,onConfirm:d,isDeleting:o=!1,deletedItems:c=[],criticalWarning:p,deleteButtonText:g="Delete"}){const[m,x]=A.useState(""),h=m===r,b=t=>{t||x(""),n(t)},l=()=>{h&&d()};return e.jsx(me,{open:a,onOpenChange:b,children:e.jsxs(ue,{className:"sm:max-w-md",children:[e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-destructive/10 flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full",children:e.jsx(ie,{className:"text-destructive h-5 w-5"})}),e.jsxs("div",{children:[e.jsx(xe,{children:s}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm",children:"This action cannot be undone"})]})]}),e.jsx(ge,{asChild:!0,children:e.jsxs("div",{className:"space-y-4",children:[c.length>0&&e.jsxs("div",{className:"bg-destructive/5 border-destructive/20 rounded-lg border p-4",children:[e.jsx("p",{className:"text-foreground mb-3 font-medium",children:"This will permanently delete:"}),e.jsx("ul",{className:"text-muted-foreground space-y-2 text-sm",children:c.map((t,j)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"bg-destructive/60 mt-2 h-1.5 w-1.5 flex-shrink-0 rounded-full"}),e.jsx("span",{children:t})]},j))})]}),p&&e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-950/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-amber-600 dark:text-amber-400"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"mb-1 font-medium text-amber-800 dark:text-amber-200",children:p.title}),e.jsx("p",{className:"text-amber-700 dark:text-amber-300",children:p.description})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"confirm-delete",className:"text-foreground mb-2 block text-sm font-medium",children:["Type"," ",e.jsx("span",{className:"text-destructive bg-destructive/10 rounded px-1.5 py-0.5 font-mono font-semibold",children:r})," ","to confirm deletion"]}),e.jsx(T,{id:"confirm-delete",value:m,onChange:t=>x(t.target.value),disabled:o,className:N("transition-colors",h&&m.length>0?"border-green-500 focus-visible:ring-green-500/20":m.length>0?"border-destructive focus-visible:ring-destructive/20":""),placeholder:r})]}),m.length>0&&!o&&e.jsx("div",{className:"flex items-center gap-2 text-sm",children:h?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Confirmation matches"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"text-destructive h-4 w-4"}),e.jsx("span",{className:"text-destructive",children:"Confirmation does not match"})]})})]})]})})]}),e.jsxs(fe,{className:"gap-3",children:[e.jsx(pe,{disabled:o,onClick:()=>x(""),children:"Cancel"}),e.jsx(je,{onClick:l,disabled:!h||o,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:o?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),g]})})]})]})})}function Ke({open:a,onOpenChange:n,authProvider:s,connection:r,onEdit:d,orgId:o}){const{getAccessTokenSilently:c}=M(),p=R(),[g,m]=A.useState(null),[x,h]=A.useState(!1),b=q(),{data:l,isLoading:t}=E({queryKey:C.authProviders.connection(o,r?.readable_id??""),queryFn:async()=>{if(!r?.readable_id)return null;const f=await c();return ae(f,o,r.readable_id)},enabled:a&&!!r?.readable_id}),j=W({mutationFn:async()=>{if(!r?.readable_id)return;const f=await c();return ke(f,o,r.readable_id)},onSuccess:()=>{p.invalidateQueries({queryKey:C.authProviders.connections(o)}),D.success("Auth provider connection deleted successfully"),h(!1),n(!1)},onError:f=>{D.error(f.message)}}),v=async(f,_)=>{try{await navigator.clipboard.writeText(f),m(_),D.success(`${_} copied to clipboard`),setTimeout(()=>m(null),2e3)}catch{D.error("Failed to copy to clipboard")}},k=f=>{f||m(null),n(f)};return!s||!r?null:e.jsxs(e.Fragment,{children:[e.jsx(U,{open:a,onOpenChange:k,children:e.jsxs(z,{className:"flex max-h-[90vh] flex-col overflow-hidden sm:max-w-lg",children:[e.jsxs(H,{className:"flex flex-row items-start justify-between space-y-0",children:[e.jsxs("div",{children:[e.jsxs(Q,{children:[s.name," Connection"]}),e.jsxs(G,{children:["View and manage your ",s.name," connection details"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:d,title:"Edit connection",children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"hover:text-destructive h-8 w-8",onClick:()=>h(!0),title:"Delete connection",children:e.jsx(ne,{className:"h-4 w-4"})})]})]}),t?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{className:"text-muted-foreground h-8 w-8 animate-spin"})}):l?e.jsxs("div",{className:"flex-1 space-y-6 overflow-y-auto py-4",children:[e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:N("flex h-14 w-14 items-center justify-center rounded-xl p-2.5","shadow-lg ring-2 ring-green-400/30","bg-card"),children:e.jsx("img",{src:b?"/airweave-logo-svg-white-darkbg.svg":"/airweave-logo-svg-lightbg-blacklogo.svg",alt:"Airweave",className:"h-full w-full object-contain"})}),e.jsx("div",{className:"absolute -right-1 -bottom-1",children:e.jsx("div",{className:N("flex h-5 w-5 items-center justify-center rounded-full border-2","bg-background border-green-500"),children:e.jsx(B,{className:"h-2.5 w-2.5 text-green-500"})})})]}),e.jsx("span",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:"Active Connection"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:N("flex h-14 w-14 items-center justify-center rounded-xl p-2.5","shadow-lg ring-2 ring-green-400/30","bg-card"),children:e.jsx("img",{src:I(s.short_name,b?"dark":"light"),alt:s.name,className:"h-full w-full object-contain"})}),e.jsx("div",{className:"absolute -right-1 -bottom-1",children:e.jsx("div",{className:N("flex h-5 w-5 items-center justify-center rounded-full border-2","bg-background border-green-500"),children:e.jsx(B,{className:"h-2.5 w-2.5 text-green-500"})})})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{label:"Name",value:l.name}),e.jsx(P,{label:"Readable ID",value:l.readable_id,mono:!0,copyable:!0,onCopy:()=>v(l.readable_id,"Readable ID"),copied:g==="Readable ID"}),l.created_by_email&&e.jsx(P,{label:"Created By",value:l.created_by_email}),e.jsx(P,{label:"Created At",value:X(l.created_at)}),e.jsx(P,{label:"Modified At",value:X(l.modified_at)}),l.masked_client_id&&e.jsx(P,{label:"Client ID",value:l.masked_client_id,mono:!0,copyable:!0,onCopy:()=>v(l.masked_client_id,"Client ID"),copied:g==="Client ID"})]})]}):e.jsx("div",{className:"text-muted-foreground py-8 text-center",children:"No connection details available"}),e.jsx(ee,{className:"border-t pt-4",children:e.jsx(w,{variant:"outline",onClick:()=>k(!1),className:"w-full",children:"Done"})})]})}),e.jsx(Oe,{open:x,onOpenChange:h,title:"Delete Auth Provider Connection",confirmValue:l?.readable_id??"",onConfirm:()=>j.mutate(),isDeleting:j.isPending,deletedItems:["This auth provider connection","All source connections using this auth provider","All associated sync configurations and data"],criticalWarning:{title:"Critical Impact",description:"Source connections will stop working immediately and cannot be recovered."},deleteButtonText:"Delete Connection"})]})}function P({label:a,value:n,mono:s,copyable:r,onCopy:d,copied:o}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-muted-foreground text-xs font-medium tracking-wider uppercase",children:a}),e.jsxs("div",{className:N("bg-muted/50 rounded-md border px-3 py-2 text-sm",r&&"group flex items-center justify-between"),children:[e.jsx("span",{className:N(s&&"font-mono break-all"),children:n}),r&&d&&e.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 transition-opacity group-hover:opacity-100",onClick:d,children:o?e.jsx($,{className:"h-3.5 w-3.5 text-green-500"}):e.jsx(be,{className:"h-3.5 w-3.5"})})]})]})}function $e({open:a,onOpenChange:n,authProvider:s,connection:r,onSuccess:d,orgId:o}){const{getAccessTokenSilently:c}=M(),p=R(),g=q(),{data:m,isLoading:x}=E({queryKey:C.authProviders.connection(o,r?.readable_id??""),queryFn:async()=>{if(!r?.readable_id)return null;const t=await c();return ae(t,o,r.readable_id)},enabled:a&&!!r?.readable_id}),{data:h,isLoading:b}=E({queryKey:C.authProviders.detail(o,s?.short_name??""),queryFn:async()=>{if(!s?.short_name)return null;const t=await c();return te(t,o,s.short_name)},enabled:a&&!!s?.short_name}),l=x||b;return!s||!r?null:e.jsx(U,{open:a,onOpenChange:n,children:e.jsxs(z,{className:"flex max-h-[90vh] flex-col overflow-hidden sm:max-w-lg",children:[e.jsxs(H,{children:[e.jsxs(Q,{children:["Edit ",s.name," Connection"]}),e.jsx(G,{children:"Update your connection details. Leave fields empty to keep current values."})]}),l?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{className:"text-muted-foreground h-8 w-8 animate-spin"})}):e.jsx(Re,{authProvider:s,connection:r,connectionDetails:m,providerDetails:h,orgId:o,isDark:g,queryClient:p,getAccessTokenSilently:c,onOpenChange:n,onSuccess:d},r.readable_id)]})})}function Re({authProvider:a,connection:n,connectionDetails:s,providerDetails:r,orgId:d,isDark:o,queryClient:c,getAccessTokenSilently:p,onOpenChange:g,onSuccess:m}){const x=se({defaultValues:{name:s?.name??"",authFields:{}},onSubmit:async({value:t})=>{h.mutate(t)}}),h=W({mutationFn:async t=>{if(!n?.readable_id)throw new Error("No connection ID");const j=await p(),v={};t.name&&t.name!==s?.name&&(v.name=t.name);const k=Object.entries(t.authFields).filter(([,f])=>f&&String(f).trim()!=="").reduce((f,[_,i])=>({...f,[_]:i}),{});return Object.keys(k).length>0&&(v.auth_fields=k),Object.keys(v).length===0?null:_e(j,d,n.readable_id,v)},onSuccess:t=>{if(t===null){D.info("No changes to update"),g(!1);return}c.invalidateQueries({queryKey:C.authProviders.connections(d)}),c.invalidateQueries({queryKey:C.authProviders.connection(d,n?.readable_id??"")}),D.success(`Successfully updated ${a?.name} connection`),g(!1),x.reset(),m?.()},onError:t=>{D.error(t.message)}}),b=(t,j)=>{const v=x.getFieldValue("authFields");x.setFieldValue("authFields",{...v,[t]:j})},l=()=>{x.reset(),g(!1)};return e.jsxs("form",{onSubmit:t=>{t.preventDefault(),x.handleSubmit()},className:"flex flex-1 flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex-1 space-y-6 overflow-y-auto py-4",children:[e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:N("flex h-20 w-20 items-center justify-center rounded-xl p-3","border shadow-sm","bg-card"),children:e.jsx("img",{src:I(a.short_name,o?"dark":"light"),alt:a.name,className:"h-full w-full object-contain"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Name"}),e.jsx(x.Field,{name:"name",children:t=>e.jsx(T,{value:t.state.value,onChange:j=>t.handleChange(j.target.value),placeholder:s?.name||"Connection name"})})]}),r?.auth_fields?.fields&&r.auth_fields.fields.length>0&&e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Update authentication credentials (leave empty to keep current values)"}),r.auth_fields.fields.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:t.title||t.name}),t.description&&e.jsx("p",{className:"text-muted-foreground text-xs",children:t.description}),e.jsx(x.Field,{name:"authFields",children:()=>e.jsx(T,{type:t.secret?"password":"text",value:x.getFieldValue("authFields")[t.name]||"",onChange:j=>b(t.name,j.target.value),placeholder:t.secret?"••••••••":`Enter new ${t.title||t.name}`})})]},t.name))]})]}),e.jsxs(ee,{className:"border-t pt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:l,disabled:h.isPending,children:"Cancel"}),e.jsx(w,{type:"submit",disabled:h.isPending,children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update"})]})]})}function Ue(){return e.jsx(we,{docPath:"auth-providers/overview.mdx"})}function ze(){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Auth Provider Setup"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Configure authentication for your source connections:"}),e.jsx("pre",{className:"bg-muted overflow-auto rounded-lg p-3 text-xs",children:e.jsx("code",{children:`// Using OAuth flow with Composio
const connection = await client.sourceConnections.create({
  name: 'My Notion Connection',
  short_name: 'notion',
  collection_id: collection.readable_id,
  authentication: {
    auth_provider: 'composio',
    // OAuth flow handled automatically
  }
});

// Using OAuth flow with Pipedream
const connection = await client.sourceConnections.create({
  name: 'My Slack Connection',
  short_name: 'slack',
  collection_id: collection.readable_id,
  authentication: {
    auth_provider: 'pipedream',
  }
});`})})]})}function He(){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold",children:"About Auth Providers"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Auth providers help manage OAuth connections to external services, allowing Airweave to securely authenticate with your data sources."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Supported Providers"}),e.jsxs("ul",{className:"text-muted-foreground mt-2 space-y-1.5 text-xs",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-foreground font-medium",children:"Composio"}),e.jsx("span",{children:"- Multi-app OAuth with 100+ integrations"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-foreground font-medium",children:"Pipedream"}),e.jsx("span",{children:"- Workflow automation with OAuth support"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-foreground text-muted-foreground font-medium",children:"Klavis"}),e.jsx("span",{className:"text-muted-foreground/70",children:"- MCP-native authentication (coming soon)"})]})]})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"How it works"}),e.jsxs("ol",{className:"text-muted-foreground mt-2 list-inside list-decimal space-y-1.5 text-xs",children:[e.jsx("li",{children:"Create an auth provider connection with your API keys"}),e.jsx("li",{children:"When creating a source connection, select the auth provider"}),e.jsx("li",{children:"Users authenticate via OAuth through the provider's secure flow"}),e.jsx("li",{children:"Tokens are securely stored and automatically refreshed"})]})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Getting Started"}),e.jsxs("div",{className:"text-muted-foreground mt-2 space-y-2 text-xs",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-foreground font-medium",children:"Composio:"})," ","Sign up at"," ",e.jsx("a",{href:"https://platform.composio.dev",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"platform.composio.dev"})," ","and get your API key from the dashboard."]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-foreground font-medium",children:"Pipedream:"})," ","Get your Client ID and Secret from"," ",e.jsx("a",{href:"https://pipedream.com/settings/api",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"pipedream.com/settings/api"})]})]})]})]})]})}function rs(){const{getAccessTokenSilently:a}=M(),{organization:n}=Pe();if(!n)throw new Error("Organization context is required but not available");const s=n.id,[r,d]=A.useState(null),[o,c]=A.useState(null),[p,g]=A.useState(null);le({title:"Auth Providers",description:"Authenticate data sources through third-party applications"}),oe({docs:e.jsx(Ue,{}),code:e.jsx(ze,{}),help:e.jsx(He,{})});const{data:m,isLoading:x,error:h}=E({queryKey:C.authProviders.list(s),queryFn:async()=>{const u=await a();return Fe(u,s)}}),{data:b,isLoading:l,error:t}=E({queryKey:C.authProviders.connections(s),queryFn:async()=>{const u=await a();return Ae(u,s)}}),j=A.useMemo(()=>m?[...m,...Z]:Z,[m]),v=u=>b?.find(F=>F.short_name===u),k=u=>{if("isComingSoon"in u&&u.isComingSoon)return;const F=v(u.short_name);F?(c(u),g(F),d("detail")):(c(u),g(null),d("configure"))},f=()=>{d(null),c(null),g(null)},_=()=>{d("edit")},i=u=>{const F=b?.find(K=>K.readable_id===u);F&&o?(g(F),d("detail")):f()},y=()=>{d("detail")},S=x||l,O=h||t;return S?e.jsx("div",{className:"p-6",children:e.jsx(ye,{})}):O?e.jsx("div",{className:"p-6",children:e.jsx(ve,{error:O instanceof Error?O:"Failed to load auth providers"})}):j.length===0?e.jsx("div",{className:"p-6",children:e.jsx(de,{icon:e.jsx(ce,{}),title:"No auth providers available",description:"Auth providers enable secure OAuth connections to external services."})}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:j.map(u=>{const F=v(u.short_name),K="isComingSoon"in u&&u.isComingSoon;return e.jsx(Te,{id:u.id,name:u.name,shortName:u.short_name,isConnected:!!F,isComingSoon:K,onClick:()=>k(u)},u.id)})}),e.jsx(Me,{open:r==="configure",onOpenChange:u=>{u||f()},authProvider:o,onSuccess:i,orgId:s}),e.jsx(Ke,{open:r==="detail",onOpenChange:u=>{u||f()},authProvider:o,connection:p,onEdit:_,orgId:s}),e.jsx($e,{open:r==="edit",onOpenChange:u=>{u||d("detail")},authProvider:o,connection:p,onSuccess:y,orgId:s})]})}export{rs as component};
