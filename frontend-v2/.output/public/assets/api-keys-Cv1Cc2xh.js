import{j as e,r as p,t as f,B as b,as as Y,T as W,V as G,a as T,W as X,$ as P,d as M,n as z,q as A,D as Z,o as ee,p as se,s as te,v as ae,L as R,aj as ne,a4 as K,ak as re,at as ie,au as oe}from"./main-BEToz-TC.js";import{u as $,A as v}from"./api-form-CPp1CwpP.js";import{g as le,D as ce,a as de,b as ue,E as me,B as pe,u as ye}from"./data-table-floating-toolbar-BMmz4eaj.js";import{E as xe}from"./empty-state-DKSl-bi2.js";import{A as ge,b as he,c as fe,d as je,e as be,f as Ce,g as ke,h as De,C as q,E as ve}from"./error-state-DJ8okmbQ.js";import{L as Ae}from"./loading-state-DlUdFJYL.js";import{c as Ne,d as Se,f as we}from"./api-keys-CDc8ip8A.js";import{u as Pe}from"./org-context-QNZ_DRQw.js";import{B as I}from"./badge-CC5o5dUU.js";import{f as Ke,g as Ie,D as Te}from"./use-docs-content-ogu5VP42.js";import{T as B}from"./trash-2-DNkcOHO8.js";import{u as Oe}from"./useForm-Cs18dAFp.js";import"./tabs-DYoc-HWa.js";import"./checkbox-CmSojv_w.js";const Ee=[{days:30,label:"30 days"},{days:60,label:"60 days"},{days:90,label:"90 days",recommended:!0},{days:180,label:"180 days"},{days:365,label:"365 days"}];function E(s){return!s||s.length<8?s:`${s.substring(0,8)}${"â€¢".repeat(32)}`}const L=Ie;function _e(s){return s<0?"text-red-500":s<=7?"text-amber-500":"text-muted-foreground"}const Fe=s=>Ke(s,"short");function Me(s){return[{id:"copy-json",label:"Copy as JSON",onSelect:s.onCopyAsJson},{id:"delete-key",label:"Delete API key",variant:"destructive",onSelect:s.onDelete}]}function O({open:s,onOpenChange:i,keys:a,onConfirm:c}){const d=a.length,l=d>1;return d===0?null:e.jsx(ge,{open:s,onOpenChange:i,children:e.jsxs(he,{className:"sm:max-w-md",children:[e.jsxs(fe,{children:[e.jsxs(je,{children:["Delete ",l?`${d} API keys`:"API key"]}),e.jsxs(be,{children:["This action cannot be undone. Any applications using"," ",l?"these keys":"this key"," will lose access immediately."]})]}),e.jsx("div",{className:`bg-muted my-4 rounded-lg border p-3 ${l?"max-h-32 space-y-1 overflow-y-auto":""}`,children:a.map(m=>e.jsx("code",{className:"block font-mono text-sm",children:E(m.decrypted_key)},m.id))}),e.jsxs(Ce,{children:[e.jsx(ke,{children:"Cancel"}),e.jsxs(De,{className:"bg-destructive hover:bg-destructive/90 text-white",onClick:()=>{c(),i(!1)},children:["Delete ",l?"keys":"key"]})]})]})})}function ze({value:s}){const[i,a]=p.useState(!1),c=()=>{navigator.clipboard.writeText(s).then(()=>{a(!0),setTimeout(()=>a(!1),2e3)},()=>{console.error("Failed to copy key")})};return e.jsx(b,{variant:"ghost",size:"icon",onClick:c,className:"size-8",title:"Copy key",children:i?e.jsx(Y,{className:"size-4 text-green-500"}):e.jsx(q,{className:"size-4"})})}function Re({expirationDate:s}){const i=L(s),a=i<0,c=i>=0&&i<=7;return a?e.jsx(I,{className:"border-transparent bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",children:"Expired"}):c?e.jsx(I,{className:"border-transparent bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",children:"Expiring soon"}):e.jsx(I,{className:"border-transparent bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:"Active"})}function $e({apiKey:s,onDelete:i}){const[a,c]=p.useState(!1),[d,l]=p.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(W,{open:d,onOpenChange:l,children:[e.jsx(G,{asChild:!0,children:e.jsxs(b,{variant:"ghost",size:"icon",className:T("text-muted-foreground size-8 transition-opacity",d?"opacity-100":"opacity-10 group-hover:opacity-50"),onClick:m=>m.stopPropagation(),children:[e.jsx(me,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(X,{align:"end",children:[e.jsxs(P,{onClick:()=>{navigator.clipboard.writeText(s.id),f.success("Copied to clipboard")},children:[e.jsx(q,{className:"size-4"}),"Copy ID"]}),e.jsxs(P,{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(s,null,2)),f.success("Copied to clipboard")},children:[e.jsx(pe,{className:"size-4"}),"Copy as JSON"]}),e.jsxs(P,{variant:"destructive",onClick:()=>c(!0),children:[e.jsx(B,{className:"size-4"}),"Delete"]})]})]}),e.jsx(O,{open:a,onOpenChange:c,keys:[s],onConfirm:()=>i([s.id])})]})}function qe({data:s,onDelete:i,selectedKey:a,onSelectKey:c,deleteDialogOpen:d,onDeleteDialogChange:l}){const[m,j]=p.useState({}),[n,t]=p.useState(!1),[g,N]=p.useState([]),w=p.useMemo(()=>[le(),{accessorKey:"decrypted_key",header:"Key",cell:({row:r})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"font-mono text-xs font-medium",children:E(r.original.decrypted_key)}),e.jsx(ze,{value:r.original.decrypted_key})]}),filterFn:(r,y,x)=>r.original.decrypted_key.toLowerCase().startsWith(x.toLowerCase())},{accessorKey:"status",header:"Status",cell:({row:r})=>e.jsx(Re,{expirationDate:r.original.expiration_date})},{accessorKey:"created_at",header:"Created",cell:({row:r})=>e.jsx("span",{className:"text-muted-foreground text-sm",children:Fe(r.original.created_at)})},{accessorKey:"expiration_date",header:"Expires",cell:({row:r})=>{const y=L(r.original.expiration_date),x=y<0;return e.jsx("span",{className:`text-sm ${_e(y)}`,children:x?`Expired ${Math.abs(y)} day${Math.abs(y)===1?"":"s"} ago`:`${y} day${y===1?"":"s"}`})}},{id:"actions",header:"",cell:({row:r})=>e.jsx("div",{className:"flex justify-end",children:e.jsx($e,{apiKey:r.original,onDelete:i})})}],[i]);return e.jsxs(e.Fragment,{children:[e.jsx(ce,{columns:w,data:s,enableRowSelection:!0,emptyMessage:"No API keys found.",getRowId:r=>r.id,rowSelection:m,onRowSelectionChange:j,highlightedRow:a,onRowHover:c,renderFloatingToolbar:({selectedRows:r,table:y})=>{const x=r.map(D=>D.original);return e.jsx(de,{selectedCount:x.length,actions:[{id:"copy-json",label:"Export",icon:ue,onClick:()=>{navigator.clipboard.writeText(JSON.stringify(x,null,2)).then(()=>{f.success(`Copied ${x.length} key${x.length>1?"s":""} as JSON`)})}},{id:"delete",label:"Delete",icon:B,variant:"destructive",onClick:()=>{N(x),t(!0)}}],onClearSelection:()=>y.resetRowSelection()})}}),e.jsx(O,{open:n,onOpenChange:t,keys:g,onConfirm:()=>{i(g.map(r=>r.id)),j({})}}),a&&e.jsx(O,{open:d,onOpenChange:l,keys:[a],onConfirm:()=>{i([a.id]),c(null)}})]})}function _({open:s,onOpenChange:i,orgId:a}){const{getAccessTokenSilently:c}=M(),d=z(),l=Oe({defaultValues:{expirationDays:90},onSubmit:async({value:n})=>{m.mutate(n.expirationDays)}}),m=$({mutationFn:async n=>{const t=await c();return Ne(t,a,n)},onSuccess:n=>{d.invalidateQueries({queryKey:A.apiKeys.list(a)}),i(!1),l.reset(),navigator.clipboard.writeText(n.decrypted_key).then(()=>{f.success("API key created and copied to clipboard")},()=>{f.success("API key created",{description:"Failed to copy to clipboard automatically"})})},onError:n=>{const t=n.message||"Failed to create API key",g=t.indexOf(", ");g>0?f.error(t.substring(0,g),{description:t.substring(g+2)}):f.error("An error occurred",{description:t})}}),j=n=>{n||l.reset(),i(n)};return e.jsx(Z,{open:s,onOpenChange:j,children:e.jsxs(ee,{className:"sm:max-w-md",children:[e.jsxs(se,{children:[e.jsx(te,{children:"Create API key"}),e.jsx(ae,{children:"Choose how long this key should remain valid"})]}),e.jsx("form",{onSubmit:n=>{n.preventDefault(),l.handleSubmit()},children:e.jsx(l.Field,{name:"expirationDays",children:n=>e.jsxs(v,{method:"POST",endpoint:"https://api.airweave.ai/api-keys",body:{expiration_days:n.state.value},onBodyChange:t=>n.handleChange(t.expiration_days||90),children:[e.jsx(v.Toggle,{}),e.jsx(v.FormView,{className:"space-y-2",children:Ee.map(t=>e.jsxs("button",{type:"button",onClick:()=>n.handleChange(t.days),className:T("flex w-full items-center justify-between rounded-lg border px-4 py-3.5 text-left transition-colors",n.state.value===t.days?"border-primary bg-primary/5 dark:bg-primary/10":"border-border hover:border-muted-foreground/25"),children:[e.jsx("span",{className:T("text-sm font-medium",n.state.value===t.days?"text-foreground":"text-muted-foreground"),children:t.label}),t.recommended&&e.jsx("span",{className:"rounded-md bg-blue-500/10 px-2 py-0.5 text-xs font-medium text-blue-600 dark:text-blue-400",children:"Recommended"})]},t.days))}),e.jsx(v.CodeView,{editable:!0}),e.jsxs(v.Footer,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>j(!1),disabled:m.isPending,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:m.isPending,children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mr-2 size-4 animate-spin"}),"Creating..."]}):"Create key"})]})]})})})]})})}function Be(){return e.jsx(Te,{docPath:"quickstart.mdx"})}function Le(){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Using API Keys"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Authenticate your requests with your API key:"}),e.jsx("pre",{className:"bg-muted overflow-auto rounded-lg p-3 text-xs",children:e.jsx("code",{children:`import { AirweaveSDK } from '@airweave/sdk';

const client = new AirweaveSDK({
  apiKey: 'YOUR_API_KEY',
  baseUrl: 'https://api.airweave.ai'
});

// Or use directly in headers
fetch('https://api.airweave.ai/collections', {
  headers: {
    'x-api-key': 'YOUR_API_KEY'
  }
});`})})]})}function Je(){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-base font-semibold",children:"API Key Security"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Keep your API keys secure and never expose them in client-side code."}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Best Practices"}),e.jsxs("ul",{className:"text-muted-foreground mt-1 space-y-1 text-xs",children:[e.jsx("li",{children:"Store keys in environment variables"}),e.jsx("li",{children:"Rotate keys periodically"}),e.jsx("li",{children:"Use different keys for dev/prod"})]})]})})]})}const F=20;function rs(){const{getAccessTokenSilently:s}=M(),{organization:i}=Pe(),a=z(),[c,d]=p.useState(!1),[l,m]=p.useState(null),[j,n]=p.useState(!1);if(!i)throw new Error("Organization context is required but not available");const t=i.id,g=()=>{d(!0)};ne({title:"API Keys",description:"Manage your API keys for programmatic access",actions:e.jsxs(b,{onClick:g,children:[e.jsx(K,{className:"mr-2 size-4"}),"Create key"]})}),re({docs:e.jsx(Be,{}),code:e.jsx(Le,{}),help:e.jsx(Je,{})});const{data:N,isLoading:w,error:r,fetchNextPage:y,hasNextPage:x,isFetchingNextPage:D}=ye({queryKey:A.apiKeys.list(t),queryFn:async({pageParam:o=0})=>{const u=await s();return we(u,t,o,F)},initialPageParam:0,getNextPageParam:(o,u)=>{if(!(!o||!Array.isArray(o))&&!(o.length<F))return u.flat().length}}),J=$({mutationFn:async o=>{const u=await s();await Promise.all(o.map(h=>Se(u,t,h)))},onMutate:async o=>{const u=A.apiKeys.list(t);await a.cancelQueries({queryKey:u});const h=a.getQueryData(u),H=new Set(o);return a.setQueryData(u,S=>S&&{...S,pages:S.pages.map(U=>U.filter(V=>!H.has(V.id)))}),{previousData:h}},onError:(o,u,h)=>{h?.previousData&&a.setQueryData(A.apiKeys.list(t),h.previousData)},onSuccess:(o,u)=>{const h=u.length;f.success(h>1?`${h} API keys deleted`:"API key deleted")},onSettled:()=>{a.invalidateQueries({queryKey:A.apiKeys.list(t)})}}),C=p.useMemo(()=>N?.pages.flat()??[],[N?.pages]),k=p.useMemo(()=>{if(C.length===0)return null;if(l){const o=C.find(u=>u.id===l);if(o)return o}return C[0]},[C,l]),Q=p.useMemo(()=>k?Me({onCopyAsJson:()=>{navigator.clipboard.writeText(JSON.stringify(k,null,2)),f.success("Copied to clipboard")},onDelete:()=>{n(!0)}}):[],[k]);return ie({pageTitle:"API Keys",pageCommands:[{id:"create-api-key",label:"Create API Key",icon:K,onSelect:g}],contextTitle:k?E(k.decrypted_key):void 0,contextCommands:Q}),w?e.jsx("div",{className:"p-6",children:e.jsx(Ae,{})}):r?e.jsx("div",{className:"p-6",children:e.jsx(ve,{error:r instanceof Error?r:"Failed to load API keys"})}):C.length===0?e.jsxs("div",{className:"p-6",children:[e.jsx(xe,{icon:e.jsx(oe,{}),title:"No API keys yet",description:"Create your first key to start using the API programmatically.",children:e.jsxs(b,{variant:"outline",size:"sm",onClick:g,children:[e.jsx(K,{className:"mr-2 size-4"}),"Create key"]})}),e.jsx(_,{open:c,onOpenChange:d,orgId:t})]}):e.jsxs("div",{children:[e.jsx(qe,{data:C,onDelete:o=>J.mutate(o),selectedKey:k,onSelectKey:o=>m(o?.id??null),deleteDialogOpen:j,onDeleteDialogChange:n}),x&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(b,{variant:"outline",onClick:()=>y(),disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mr-2 size-4 animate-spin"}),"Loading..."]}):"Load more"})}),e.jsx(_,{open:c,onOpenChange:d,orgId:t})]})}export{rs as component};
