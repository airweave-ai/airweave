import{d as A,n as T,r as h,t as S,q as C,j as e,D as _,o as k,p as K,s as L,v as R,a as $,B as F,L as w,u as z,w as P,O as V}from"./main-BEToz-TC.js";import{c as Q}from"./collections-Yw3Eirdu.js";import"./use-is-dark-pSwRFwVX.js";import{u as I,O as M}from"./org-context-QNZ_DRQw.js";import"./checkbox-CmSojv_w.js";import{u as G}from"./useForm-Cs18dAFp.js";import{u as B,A as x}from"./api-form-CPp1CwpP.js";import{I as D}from"./input-Dgezjod8.js";import{L as H}from"./loading-state-DlUdFJYL.js";import{f as U}from"./api-keys-CDc8ip8A.js";import{f as Y,a as Z}from"./auth-providers-Bc9ymBaZ.js";import"./tabs-DYoc-HWa.js";function O(r=6){const s="abcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let l=0;l<r;l++)a+=s.charAt(Math.floor(Math.random()*s.length));return a}function J(r,s){if(!r.trim())return"";let a=r.toLowerCase().trim();return a=a.replace(/[^a-z0-9\s]/g,""),a=a.replace(/\s+/g,"-"),a=a.replace(/-+/g,"-"),a=a.replace(/^-+|-+$/g,""),a?`${a}-${s}`:""}function W({open:r,onOpenChange:s,orgId:a,onSuccess:l}){const{getAccessTokenSilently:n}=A(),b=T(),[c,d]=h.useState(O),[u,i]=h.useState(!1),[g,f]=h.useState(""),[E,y]=h.useState("");h.useEffect(()=>{r&&d(O())},[r]);const m=G({defaultValues:{name:"",readableId:""},onSubmit:async({value:t})=>{j.mutate(t)}}),j=B({mutationFn:async t=>{const o=await n();return Q(o,a,{name:t.name,readable_id:t.readableId||void 0})},onSuccess:t=>{b.invalidateQueries({queryKey:C.collections.all(a)}),S.success(`Collection "${t.name}" created!`,{description:`ID: ${t.readable_id}`}),s(!1),m.reset(),i(!1),f(""),y(""),l?.(t)},onError:t=>{const o=t.message||"Failed to create collection",v=o.indexOf(", ");v>0?S.error(o.substring(0,v),{description:o.substring(v+2)}):S.error("Failed to create collection",{description:o})}}),N=t=>{t||(m.reset(),i(!1),f(""),y("")),s(t)},p=u?E:J(g,c);return e.jsx(_,{open:r,onOpenChange:N,children:e.jsxs(k,{className:"sm:max-w-md",children:[e.jsxs(K,{children:[e.jsx(L,{children:"Create collection"}),e.jsx(R,{children:"Collections are searchable knowledge bases for your data"})]}),e.jsx("form",{onSubmit:t=>{t.preventDefault(),!u&&p&&m.setFieldValue("readableId",p),m.handleSubmit()},children:e.jsxs(x,{method:"POST",endpoint:"https://api.airweave.ai/collections",body:{name:g,...p&&{readable_id:p}},onBodyChange:t=>{typeof t.name=="string"&&(m.setFieldValue("name",t.name),f(t.name)),typeof t.readable_id=="string"&&(m.setFieldValue("readableId",t.readable_id),y(t.readable_id),i(!0))},children:[e.jsx(x.Toggle,{}),e.jsxs(x.FormView,{className:"space-y-4",children:[e.jsx(m.Field,{name:"name",validators:{onChange:({value:t})=>{if(!t.trim())return"Name is required";if(t.length<4)return"Name must be at least 4 characters";if(t.length>64)return"Name must be less than 64 characters"}},children:t=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"name",className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Name"}),e.jsx(D,{id:"name",placeholder:"e.g., Customer Support Tickets",value:t.state.value,onChange:o=>{t.handleChange(o.target.value),f(o.target.value)},onBlur:t.handleBlur,"aria-invalid":t.state.meta.errors.length>0?"true":void 0}),t.state.meta.errors.length>0&&e.jsx("p",{className:"text-destructive text-sm",children:t.state.meta.errors[0]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"4-64 characters. This is the display name for your collection."})]})}),e.jsx(m.Field,{name:"readableId",children:t=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"readableId",className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["ID"," ",e.jsx("span",{className:"text-muted-foreground font-normal",children:"(optional)"})]}),e.jsx(D,{id:"readableId",placeholder:"Auto-generated from name",value:u?t.state.value:"",onChange:o=>{t.handleChange(o.target.value),y(o.target.value),i(!0)},onBlur:t.handleBlur}),p&&e.jsxs("p",{className:"text-muted-foreground text-xs",children:[u?"Custom ID: ":"Generated ID: ",e.jsx("code",{className:$("rounded px-1 py-0.5","bg-muted font-mono text-xs"),children:p})]})]})})]}),e.jsx(x.CodeView,{editable:!0}),e.jsxs(x.Footer,{children:[e.jsx(F,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:j.isPending,children:"Cancel"}),e.jsx(F,{type:"submit",disabled:j.isPending||!g.trim(),children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 size-4 animate-spin"}),"Creating..."]}):"Create collection"})]})]})})]})})}function X(){const r=z(),{organization:s,getOrgSlug:a}=I(),{isOpen:l,close:n,preSelectedSource:b}=P(),c=P(i=>i.clearPreSelectedSource);if(!s)return null;const d=a(s),u=i=>{const g=b;c();const f=g?{addSource:g}:void 0;r({to:`/${d}/collections/${i.readable_id}`,state:f})};return e.jsx(W,{open:l,onOpenChange:i=>{i||n()},orgId:s.id,onSuccess:u})}const q=20;function ee(){const{organization:r}=I(),{getAccessTokenSilently:s}=A(),a=T(),l=h.useRef(null);return h.useEffect(()=>{if(!r?.id)return;const n=r.id;if(l.current===n)return;l.current=n,(async()=>{try{const c=await s();a.prefetchInfiniteQuery({queryKey:C.apiKeys.list(n),queryFn:({pageParam:d=0})=>U(c,n,d,q),initialPageParam:0,getNextPageParam:(d,u)=>{if(!(!d||d.length<q))return u.flat().length},staleTime:1e3*60*5}),a.prefetchQuery({queryKey:C.authProviders.list(n),queryFn:()=>Y(c,n),staleTime:1e3*60*5}),a.prefetchQuery({queryKey:C.authProviders.connections(n),queryFn:()=>Z(c,n),staleTime:1e3*60*5})}catch(c){console.debug("Org data prefetch failed:",c)}})()},[r?.id,s,a]),null}function ge(){return e.jsx(M,{children:e.jsx(te,{})})}function te(){const{organization:r,isLoading:s}=I();return s||!r?e.jsx("div",{className:"flex h-full items-center justify-center p-6",children:e.jsx(H,{})}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsx(V,{}),e.jsx(X,{})]})}export{ge as component};
