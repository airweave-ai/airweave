import{j as e,r as u,t as D,a as S,T as V,V as Z,B as v,W as X,$ as O,A as Y,z as ee,E as se,u as te,d as ae,n as oe,w as F,aj as ne,a4 as L,ak as re,q as f,i as ie,aw as le,L as ce}from"./main-BEToz-TC.js";import{u as de}from"./api-form-CPp1CwpP.js";import{g as ue,D as me,a as ge,b as pe,E as xe,B as he,u as fe}from"./data-table-floating-toolbar-BMmz4eaj.js";import{E as je}from"./empty-state-DKSl-bi2.js";import{A as Ce,b as ye,c as be,d as ve,e as De,f as Se,g as we,h as Ne,C as ke,E as Ae}from"./error-state-DJ8okmbQ.js";import{L as Te}from"./loading-state-DlUdFJYL.js";import{f as Ee,d as Oe}from"./collections-Yw3Eirdu.js";import{u as _e}from"./use-is-dark-pSwRFwVX.js";import{f as Ie,g as ze,a as Me,C as Fe,b as Le,c as Pe,d as qe}from"./sidebar-content-BALcDoUB.js";import{u as Ke}from"./org-context-QNZ_DRQw.js";import{B as Re}from"./badge-CC5o5dUU.js";import{T as K}from"./trash-2-DNkcOHO8.js";import"./tabs-DYoc-HWa.js";import"./checkbox-CmSojv_w.js";import"./use-docs-content-ogu5VP42.js";function _({open:a,onOpenChange:t,collections:l,onConfirm:o}){const r=l.length,c=r>1;return r===0?null:e.jsx(Ce,{open:a,onOpenChange:t,children:e.jsxs(ye,{className:"sm:max-w-md",children:[e.jsxs(be,{children:[e.jsxs(ve,{children:["Delete ",c?`${r} collections`:"collection"]}),e.jsxs(De,{children:["This action cannot be undone."," ",c?"These collections":"This collection"," and all associated source connections, synced data, and configuration will be permanently deleted."]})]}),e.jsx("div",{className:`bg-muted my-4 rounded-lg border p-3 ${c?"max-h-32 space-y-1 overflow-y-auto":""}`,children:l.map(m=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:m.name}),e.jsxs("code",{className:"text-muted-foreground font-mono text-xs",children:[m.readable_id,".airweave.ai"]})]},m.id))}),e.jsxs(Se,{children:[e.jsx(we,{children:"Cancel"}),e.jsxs(Ne,{className:"bg-destructive hover:bg-destructive/90 text-white",onClick:()=>{o(),t(!1)},children:["Delete ",c?"collections":"collection"]})]})]})})}function Be({status:a}){const t=ze(a);return e.jsx(Re,{variant:t.variant==="success"?"default":t.variant==="warning"?"secondary":t.variant==="destructive"?"destructive":"outline",className:S("w-fit",t.variant==="success"&&"border-transparent bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",t.variant==="warning"&&"border-transparent bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400"),children:t.label})}function $e({collection:a,onDelete:t}){const[l,o]=u.useState(!1),[r,c]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(V,{open:r,onOpenChange:c,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(v,{variant:"ghost",size:"icon",className:S("text-muted-foreground size-8 transition-opacity",r?"opacity-100":"opacity-10 group-hover:opacity-50"),onClick:m=>m.stopPropagation(),children:[e.jsx(xe,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(X,{align:"end",children:[e.jsxs(O,{onClick:()=>{navigator.clipboard.writeText(a.id),D.success("Copied to clipboard")},children:[e.jsx(ke,{className:"size-4"}),"Copy ID"]}),e.jsxs(O,{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(a,null,2)),D.success("Copied to clipboard")},children:[e.jsx(he,{className:"size-4"}),"Copy as JSON"]}),e.jsxs(O,{variant:"destructive",onClick:()=>o(!0),children:[e.jsx(K,{className:"size-4"}),"Delete"]})]})]}),e.jsx(_,{open:l,onOpenChange:o,collections:[a],onConfirm:()=>t([a.readable_id])})]})}function Qe({data:a,onDelete:t,onRowClick:l,selectedCollection:o,onSelectCollection:r,deleteDialogOpen:c,onDeleteDialogChange:m}){const[h,j]=u.useState({}),[w,C]=u.useState(!1),[d,N]=u.useState([]),y=u.useMemo(()=>[ue(),{accessorKey:"name",header:"Name",cell:({row:n})=>e.jsx("span",{className:"font-medium",children:n.original.name})},{accessorKey:"readable_id",header:"Domain",cell:({row:n})=>e.jsxs("code",{className:"text-muted-foreground font-mono text-xs",children:[n.original.readable_id,".airweave.ai"]})},{accessorKey:"status",header:"Status",cell:({row:n})=>e.jsx(Be,{status:n.original.status})},{accessorKey:"created_at",header:"Created",cell:({row:n})=>e.jsx("span",{className:"text-muted-foreground text-sm",children:Ie(n.original.created_at)})},{id:"actions",header:"",cell:({row:n})=>e.jsx("div",{className:"flex justify-end",children:e.jsx($e,{collection:n.original,onDelete:t})})}],[t]);return e.jsxs(e.Fragment,{children:[e.jsx(me,{columns:y,data:a,enableRowSelection:!0,emptyMessage:"No collections found.",getRowId:n=>n.id,rowSelection:h,onRowSelectionChange:j,highlightedRow:o,onRowHover:r,onRowClick:l,renderFloatingToolbar:({selectedRows:n,table:k})=>{const p=n.map(A=>A.original);return e.jsx(ge,{selectedCount:p.length,actions:[{id:"copy-json",label:"Export",icon:pe,onClick:()=>{navigator.clipboard.writeText(JSON.stringify(p,null,2)).then(()=>{D.success(`Copied ${p.length} collection${p.length>1?"s":""} as JSON`)})}},{id:"delete",label:"Delete",icon:K,variant:"destructive",onClick:()=>{N(p),C(!0)}}],onClearSelection:()=>k.resetRowSelection()})}}),e.jsx(_,{open:w,onOpenChange:C,collections:d,onConfirm:()=>{t(d.map(n=>n.readable_id)),j({})}}),o&&e.jsx(_,{open:c,onOpenChange:m,collections:[o],onConfirm:()=>{t([o.readable_id]),r(null)}})]})}function He({name:a,shortName:t,onClick:l,disabled:o=!1}){const r=_e();return e.jsxs("div",{className:S("group border-border/50 flex items-center justify-center gap-2 overflow-hidden rounded-lg border px-3 py-1.5 shadow-xs transition-all",o?"bg-card/50 cursor-not-allowed opacity-50":"bg-card hover:bg-card/50 hover:border-border cursor-pointer"),onClick:o?void 0:l,children:[e.jsx(Je,{shortName:t,isDark:r}),e.jsx("div",{className:S("truncate text-xs font-medium",o&&"text-muted-foreground"),children:a})]})}function Je({shortName:a,isDark:t}){return e.jsxs(Y,{className:"size-6 rounded",children:[e.jsx(ee,{src:Me(a,t?"dark":"light"),alt:`${a} icon`}),e.jsx(se,{className:"rounded text-xs font-semibold",children:a[0].toUpperCase()})]})}function P({sources:a,onSourceClick:t,title:l="Start with a source"}){return a.length===0?null:e.jsxs("div",{children:[e.jsx("h2",{className:"text-muted-foreground mb-4 font-mono font-medium uppercase opacity-70",children:l}),e.jsx("div",{className:"flex flex-wrap gap-3",children:a.map(o=>e.jsx(He,{id:o.id,name:o.name,shortName:o.short_name,onClick:()=>t(o)},o.id))})]})}const q=24;function ls(){const a=te(),{getAccessTokenSilently:t}=ae(),{organization:l,getOrgSlug:o}=Ke(),r=oe(),c=F(s=>s.open),m=F(s=>s.openWithSource),[h,j]=u.useState(null),[w,C]=u.useState(!1);if(!l)throw new Error("Organization context is required but not available");const d=l.id,N=o(l);ne({title:"Collections",description:"Manage your searchable knowledge bases",actions:e.jsxs(v,{onClick:c,children:[e.jsx(L,{className:"mr-2 size-4"}),"Create Collection"]})}),re({docs:e.jsx(Pe,{}),code:e.jsx(Le,{}),help:e.jsx(Fe,{})});const{data:y,isLoading:n,error:k,fetchNextPage:p,hasNextPage:A,isFetchingNextPage:I}=fe({queryKey:f.collections.list(d),queryFn:async({pageParam:s=0})=>{const i=await t();return Ee(i,d,s,q)},initialPageParam:0,getNextPageParam:(s,i)=>{if(!(!s||!Array.isArray(s))&&!(s.length<q))return i.flat().length}}),{data:T,isLoading:R,error:B}=ie({queryKey:f.sources.list(d),queryFn:async()=>{const s=await t();return qe(s,d)}}),$=de({mutationFn:async s=>{const i=await t();await Promise.all(s.map(g=>Oe(i,d,g)))},onMutate:async s=>{const i=f.collections.list(d);await r.cancelQueries({queryKey:i});const g=r.getQueryData(i),G=new Set(s);return r.setQueryData(i,b=>b&&{...b,pages:b.pages.map(W=>W.filter(U=>!G.has(U.readable_id)))}),{previousData:g}},onError:(s,i,g)=>{g?.previousData&&r.setQueryData(f.collections.list(d),g.previousData)},onSuccess:(s,i)=>{const g=i.length;D.success(g>1?`${g} collections deleted`:"Collection deleted")},onSettled:()=>{r.invalidateQueries({queryKey:f.collections.list(d)})}}),x=u.useMemo(()=>y?.pages.flat()??[],[y?.pages]),Q=u.useMemo(()=>{if(x.length===0)return null;if(h){const s=x.find(i=>i.id===h);if(s)return s}return x[0]},[x,h]),z=u.useMemo(()=>T?[...T].sort((s,i)=>s.name.localeCompare(i.name)):[],[T]),M=s=>{m(s.short_name,s.name)},H=s=>{a({to:`/${N}/collections/${s.readable_id}`})},J=n||R,E=k||B;return J&&x.length===0?e.jsx("div",{className:"p-6",children:e.jsx(Te,{})}):E?e.jsx("div",{className:"p-6",children:e.jsx(Ae,{error:E instanceof Error?E:"Failed to load collections"})}):x.length===0&&!n?e.jsxs("div",{className:"space-y-8 p-6",children:[e.jsx(je,{icon:e.jsx(le,{}),title:"Create your first collection",description:"Collections help you organize and search your data from multiple sources.",children:e.jsxs(v,{variant:"outline",onClick:c,children:[e.jsx(L,{className:"mr-2 size-4"}),"Create Collection"]})}),e.jsx(P,{sources:z,onSourceClick:M})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsx(Qe,{data:x,onDelete:s=>$.mutate(s),onRowClick:H,selectedCollection:Q,onSelectCollection:s=>j(s?.id??null),deleteDialogOpen:w,onDeleteDialogChange:C}),A&&e.jsx("div",{className:"flex justify-center",children:e.jsx(v,{variant:"outline",onClick:()=>p(),disabled:I,children:I?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"mr-2 size-4 animate-spin"}),"Loading..."]}):"Load more"})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx(P,{sources:z,onSourceClick:M})})]})}export{ls as component};
